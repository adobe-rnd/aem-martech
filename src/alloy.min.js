/**
 * Copyright 2019 Adobe. All rights reserved.
 * This file is licensed to you under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License. You may obtain a copy
 * of the License at http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software distributed under
 * the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS
 * OF ANY KIND, either express or implied. See the License for the specific language
 * governing permissions and limitations under the License.
 */

!function(){"use strict";var e=e=>null==e,t=t=>!e(t)&&!Array.isArray(t)&&"object"==typeof t;
  /*! js-cookie v3.0.5 | MIT */
  function n(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)e[r]=n[r]}return e}var r=function e(t,r){function o(e,o,i){if("undefined"!=typeof document){"number"==typeof(i=n({},r,i)).expires&&(i.expires=new Date(Date.now()+864e5*i.expires)),i.expires&&(i.expires=i.expires.toUTCString()),e=encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var a="";for(var s in i)i[s]&&(a+="; "+s,!0!==i[s]&&(a+="="+i[s].split(";")[0]));return document.cookie=e+"="+t.write(o,e)+a}}return Object.create({set:o,get:function(e){if("undefined"!=typeof document&&(!arguments.length||e)){for(var n=document.cookie?document.cookie.split("; "):[],r={},o=0;o<n.length;o++){var i=n[o].split("="),a=i.slice(1).join("=");try{var s=decodeURIComponent(i[0]);if(r[s]=t.read(a,s),e===s)break}catch(e){}}return e?r[e]:r}},remove:function(e,t){o(e,"",n({},t,{expires:-1}))},withAttributes:function(t){return e(this.converter,n({},this.attributes,t))},withConverter:function(t){return e(n({},this.converter,t),this.attributes)}},{attributes:{value:Object.freeze(r)},converter:{value:Object.freeze(t)}})}({read:function(e){return'"'===e[0]&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"}),o={get:r.get.bind(r),set:r.set.bind(r),remove:r.remove.bind(r),withConverter:r.withConverter.bind(r)};const i=(e,n)=>{Object.keys(n).forEach((r=>{t(e[r])&&t(n[r])?i(e[r],n[r]):e[r]=n[r]}))};var a=function(t){if(e(t))throw new TypeError('deepAssign "target" cannot be null or undefined');const n=Object(t);for(var r=arguments.length,o=new Array(r>1?r-1:0),a=1;a<r;a++)o[a-1]=arguments[a];return o.forEach((e=>i(n,Object(e)))),n},s=(e,t)=>n=>{const r=t.split(".").reduce(((e,t)=>(e[t]=e[t]||{},e[t])),e);a(r,n)},c=()=>{const e=[];return{add(t){e.push(t)},call(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Promise.all(e.map((e=>e(...n))))}}},d=e=>{let{logger:t,cookieJar:n}=e;return{...n,set(e,r,o){t.info("Setting cookie",{name:e,value:r,...o}),n.set(e,r,o)}}},l=()=>{const e={};return e.promise=new Promise(((t,n)=>{e.resolve=t,e.reject=n})),e};const u=(e,t)=>e===t;var p=(e,t)=>e.appendChild(t);var g=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];const i=(arguments.length>4&&void 0!==arguments[4]?arguments[4]:document).createElement(e);return Object.keys(n).forEach((e=>{i.setAttribute(e,n[e])})),((e,n)=>{Object.keys(n).forEach((r=>{if("style"===r&&t(n[r])){const t=n[r];Object.keys(t).forEach((n=>{e.style[n]=t[n]}))}else e[r]=n[r]}))})(i,r),o.forEach((e=>p(i,e))),i};const m="IMG",f="STYLE",h="SCRIPT";var y=e=>{let{src:t,currentDocument:n=document}=e;return new Promise(((e,r)=>{g(m,{src:t},{onload:e,onerror:r,onabort:r},[],n)}))},v=e=>"function"==typeof e,w=e=>Array.isArray(e)&&e.length>0,b=e=>Array.isArray(e)?e:null==e?[]:[].slice.call(e);const E=/^\s*>/;var C=(e,t)=>E.test(t)?b(e.querySelectorAll(":scope "+t)):b(e.querySelectorAll(t)),I=":shadow";const k=(e,t)=>{const n=t;if(!n.startsWith(">"))return n;return(e instanceof Element||e instanceof Document?":scope":":host")+" "+n};var S=(e,t)=>{const n=(e=>e.split(I))(t);if(n.length<2)return C(e,t);let r=e;for(let e=0;e<n.length;e+=1){const t=n[e].trim();if(""===t&&r.shadowRoot){r=r.shadowRoot;continue}const o=k(r,t),i=C(r,o);if(0===i.length||!i[0]||!i[0].shadowRoot)return i;r=i[0].shadowRoot}},D=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document;return-1===e.indexOf(I)?C(t,e):S(t,e)};const P="MutationObserver",T={childList:!0,subtree:!0},R=e=>new Error("Could not find: "+e),O=e=>new Promise(e);var N=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:D,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5e3,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:window,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:document;const i=t(e);return w(i)?Promise.resolve(i):(e=>v(e[P]))(r)?((e,t,n,r,o)=>O(((i,a)=>{let s;const c=new e[P]((()=>{const e=o(n);w(e)&&(c.disconnect(),s&&clearTimeout(s),i(e))}));s=setTimeout((()=>{c.disconnect(),a(R(n))}),r),c.observe(t,T)})))(r,o,e,n,t):(e=>"visible"===e.visibilityState)(o)?((e,t,n,r)=>O(((o,i)=>{const a=()=>{const n=r(t);w(n)?o(n):e.requestAnimationFrame(a)};a(),setTimeout((()=>{i(R(t))}),n)})))(r,e,n,t):((e,t,n)=>O(((r,o)=>{const i=()=>{const t=n(e);w(t)?r(t):setTimeout(i,100)};i(),setTimeout((()=>{o(R(e))}),t)})))(e,n,t)},A=e=>{const t=e.parentNode;return t?t.removeChild(e):null};const M={name:"Adobe Alloy"},x={style:{display:"none",width:0,height:0}};var q=e=>t(e)&&0===Object.keys(e).length;const L=(n,r)=>e(n)||!t(n)?n:Object.keys(n).reduce(((e,o)=>{const i=n[o];if(t(i)){const t=L(i,r);return q(t)?e:{...e,[o]:t}}return r(i)?{...e,[o]:i}:e}),{}),U=e=>(e=>{let t=2166136261;const n=(new TextEncoder).encode(e);for(let e=0;e<n.length;e+=1)t^=n[e],t=Math.imul(t,16777619);return t>>>0})(e).toString(16).padStart(8,"0");var j="com.adobe.alloy.";const B=j+"getTld";var F="kndctr",_=e=>e.replace("@","_"),V=(e,t)=>F+"_"+_(e)+"_"+t,H=(e,t)=>{const n={};return e.forEach((e=>{const r=t(e);n[r]||(n[r]=[]),n[r].push(e)})),n};const z="Chrome",J="Edge",G="EdgeChromium",Q="Firefox",X="IE",W="Safari",Y="Unknown";var K=e=>{let t,n=!1;return()=>(n||(n=!0,t=e()),t)};const $=[z,J,G,"IE",Y];var Z=e=>{let{orgId:t}=e;const n=V(t,"identity");return()=>Boolean(o.get(n))};const ee=(e,t,n)=>({getItem(r){try{return e[t].getItem(n+r)}catch{return null}},setItem(r,o){try{return e[t].setItem(n+r,o),!0}catch{return!1}},clear(){try{return Object.keys(e[t]).forEach((r=>{r.startsWith(n)&&e[t].removeItem(r)})),!0}catch{return!1}}});var te=e=>t=>{const n=j+t;return{session:ee(e,"sessionStorage",n),persistent:ee(e,"localStorage",n)}},ne=e=>"boolean"==typeof e,re=e=>"number"==typeof e&&!Number.isNaN(e),oe=e=>{const t=parseInt(e,10);return re(t)&&e===t},ie=e=>"string"==typeof e,ae=e=>ie(e)&&e.length>0,se=()=>{};const ce=e=>{const t={},n=e.split(".");switch(n.length){case 1:t.subdomain="",t.domain=e,t.topLevelDomain="";break;case 2:t.subdomain="",t.domain=e,t.topLevelDomain=n[1];break;case 3:t.subdomain="www"===n[0]?"":n[0],t.domain=e,t.topLevelDomain=n[2];break;case 4:t.subdomain="www"===n[0]?"":n[0],t.domain=e,t.topLevelDomain=n[2]+"."+n[3]}return t},de=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ce;ie(e)||(e="");const n=(e=>{try{const t=new URL(e);let n=t.pathname;return e.endsWith("/")||"/"!==n||(n=""),{host:t.hostname,path:n,query:t.search.replace(/^\?/,""),anchor:t.hash.replace(/^#/,"")}}catch{return{host:"",path:"",query:"",anchor:""}}})(e),{host:r,path:o,query:i,anchor:a}=n;return{path:o,query:i,fragment:a,...t(r)}};var le,ue;function pe(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var ge=(ue||(ue=1,le={parse:function(e){return function(e){var t={};if(!e||"string"!=typeof e)return t;var n=e.trim().replace(/^[?#&]/,""),r=new URLSearchParams(n),o=r.keys();do{var i=o.next(),a=i.value;if(a){var s=r.getAll(a);1===s.length?t[a]=s[0]:t[a]=s}}while(!1===i.done);return t}(e)},stringify:function(e){return function(e){var t="{{space}}",n=new URLSearchParams;return Object.keys(e).forEach((function(r){var o=e[r];"string"==typeof e[r]?o=o.replace(/ /g,t):["object","undefined"].includes(typeof o)&&!Array.isArray(o)&&(o=""),Array.isArray(o)?o.forEach((function(e){n.append(r,e)})):n.append(r,o)})),n.toString().replace(new RegExp(encodeURIComponent(t),"g"),"%20")}(e)}}),le),me=pe(ge);const fe=e=>Array.isArray(e)?e.map((e=>fe(e))):"object"==typeof e&&null!==e?Object.keys(e).sort().reduce(((t,n)=>(t[n]=fe(e[n]),t)),{}):e;var he=e=>e instanceof Error?e:new Error(e),ye=e=>{let{error:t,message:n}=e;try{t.message=n}catch{}},ve=e=>{let{error:t,message:n}=e;const r=he(t),o=n+"\nCaused by: "+r.message;return ye({error:r,message:o}),r},we=(e,t)=>{if(re(e)||ie(e)){const t=Math.round(Number(e));if(!Number.isNaN(t))return t}return t};const be=(e,t,n)=>(""+e).padStart(t,n);const Ee=[];for(let e=0;e<256;++e)Ee.push((e+256).toString(16).slice(1));let Ce;const Ie=new Uint8Array(16);var ke={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function Se(e,t,n){if(ke.randomUUID&&!t&&!e)return ke.randomUUID();const r=(e=e||{}).random??e.rng?.()??function(){if(!Ce){if("undefined"==typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Ce=crypto.getRandomValues.bind(crypto)}return Ce(Ie)}();if(r.length<16)throw new Error("Random bytes length must be >= 16");if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){if((n=n||0)<0||n+16>t.length)throw new RangeError("UUID byte range "+n+":"+(n+15)+" is out of buffer bounds");for(let e=0;e<16;++e)t[n+e]=r[e];return t}return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(Ee[e[t+0]]+Ee[e[t+1]]+Ee[e[t+2]]+Ee[e[t+3]]+"-"+Ee[e[t+4]]+Ee[e[t+5]]+"-"+Ee[e[t+6]]+Ee[e[t+7]]+"-"+Ee[e[t+8]]+Ee[e[t+9]]+"-"+Ee[e[t+10]]+Ee[e[t+11]]+Ee[e[t+12]]+Ee[e[t+13]]+Ee[e[t+14]]+Ee[e[t+15]]).toLowerCase()}(r)}const De=e=>function(t,n){return null==t?t:e.call(this,t,n)},Pe=(e,t)=>function(n,r){return t.call(this,e.call(this,n,r),r)},Te=(e,t)=>function(n,r){const o=[],i=[e,t].reduce(((e,t)=>{try{return t.call(this,e,r)}catch(t){return o.push(t),e}}),n);if(o.length)throw new Error(o.join("\n"));return i},Re=(e,t,n)=>Object.assign(Pe(e,t),e,n),Oe=(e,t,n)=>Object.assign(Pe(e,De(t)),e,n),Ne=(e,t,n,r)=>{if(!e)throw new Error("'"+n+"': Expected "+r+", but got "+JSON.stringify(t)+".")};var Ae=(e,t)=>(Ne(ne(e),e,t,"true or false"),e),Me=(e,t)=>(Ne(v(e),e,t,"a function"),e),xe=(e,t)=>function(n,r){let o;const i=e.find((e=>{try{return o=e.call(this,n,r),!0}catch{return!1}}));return Ne(i,n,r,t),o},qe=e=>function(t,n){Ne(Array.isArray(t),t,n,"an array");const r=[],o=t.map(((o,i)=>{try{return e.call(this,o,n+"["+i+"]",t)}catch(e){return void r.push(e.message)}}));if(r.length)throw new Error(r.join("\n"));return o},Le=e=>function(n,r){Ne(t(n),n,r,"an object");const o=[],i={};if(Object.keys(n).forEach((t=>{const a=n[t],s=r?r+"."+t:t;try{const n=e.call(this,a,s);void 0!==n&&(i[t]=n)}catch(e){o.push(e.message)}})),o.length)throw new Error(o.join("\n"));return i},Ue=(e,t)=>(n,r)=>(Ne(n>=t,n,r,e+" greater than or equal to "+t),n),je=e=>(n,r)=>(t(n)?Ne(!q(n),n,r,e):Ne(n.length>0,n,r,e),n),Be=e=>function(n,r){Ne(t(n),n,r,"an object");const o=[],i={};if(Object.keys(e).forEach((t=>{const a=n[t],s=e[t],c=r?r+"."+t:t;try{const e=s.call(this,a,c);void 0!==e&&(i[t]=e)}catch(e){o.push(e.message)}})),Object.keys(n).forEach((e=>{Object.prototype.hasOwnProperty.call(i,e)||(i[e]=n[e])})),o.length)throw new Error(o.join("\n"));return i},Fe=(e,n,r)=>function(o,i){Ne(t(o),o,i,"an object");const{[e]:a,[r]:s,...c}=o,d=n(a,i);if(void 0!==d){let t="The field '"+e+"' is deprecated. Use '"+r+"' instead.";if(i&&(t="'"+i+"': "+t),void 0!==s&&s!==d)throw new Error(t);this&&this.logger&&this.logger.warn(t)}return{[r]:s||d,...c}},_e=()=>(e,t)=>(Ne((e=>{const t=Object.create(null);for(let n=0;n<e.length;n+=1){const r=e[n];if(r in t)return!1;t[r]=!0}return!0})(e),e,t,"array values to be unique"),e);const Ve=/^[a-z0-9.-]{1,}$/i;var He=(e,t)=>(Ne(Ve.test(e),e,t,"a valid domain"),e),ze=(e,t)=>(Ne(oe(e),e,t,"an integer"),e),Je=(e,t)=>(Ne(re(e),e,t,"a number"),e),Ge=(e,t)=>(Ne((e=>{try{return null!==RegExp(e)}catch{return!1}})(e),e,t,"a regular expression"),e),Qe=(e,t)=>{if(null==e)throw new Error("'"+t+"' is a required option");return e},Xe=(e,t)=>(Ne(ie(e),e,t,"a string"),e);const We=e=>e;We.default=function(e){return Re(this,(e=>t=>null==t?e:t)(e))},We.required=function(){return Re(this,Qe)},We.deprecated=function(e){return Re(this,function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"This field has been deprecated";return function(t,n){let r=e;return void 0!==t&&(n&&(r="'"+n+"': "+r),this&&this.logger&&this.logger.warn(r)),t}}(e))};const Ye=function(){return Oe(this,He)},Ke=function(e){return Oe(this,Ue("an integer",e))},$e=function(e){return Oe(this,Ue("a number",e))},Ze=function(e){return Oe(this,(t="a number",n=e,(e,r)=>(Ne(e<=n,e,r,t+" less than or equal to "+n),e)));var t,n},et=function(){return Oe(this,ze,{minimum:Ke})},tt=function(){return Oe(this,je("a non-empty string"))},nt=function(){return Oe(this,je("a non-empty array"))},rt=function(){return Oe(this,je("a non-empty object"))},ot=function(){return Oe(this,Ge)},it=function(e){return Oe(this,(e=>(t,n)=>(Ne(e.test(t),t,n,"does not match the "+e.toString()),t))(e))},at=function(){return Oe(this,(()=>{const e=[];return(t,n)=>(Ne(-1===e.indexOf(t),t,n,"a unique value across instances"),e.push(t),t)})())},st=function(){return Oe(this,_e())},ct=e=>({noUnknownFields:function(){return Oe(this,(e=>(t,n)=>{const r=[];if(Object.keys(t).forEach((t=>{if(!e[t]){const e=n?n+"."+t:t;r.push("'"+e+"': Unknown field.")}})),r.length)throw new Error(r.join("\n"));return t})(e))},nonEmpty:rt,concat:function(t){const n={...e,...t.schema};return Oe(this,t,ct(n))},renamed:function(e,t,n){return r=this,o=Fe(e,t,n),Object.assign(Te(De(o),r),r,i);var r,o,i},schema:e}),dt=function(e,t){return Re(this,xe(e,t))}.bind(We),lt=function(){return this}.bind(We),ut=function(e){return Oe(this,qe(e),{nonEmpty:nt,uniqueItems:st})}.bind(We),pt=function(){return Oe(this,Ae)}.bind(We),gt=function(){return Oe(this,Me)}.bind(We),mt=function(e){return Oe(this,(e=>(t,n)=>(Ne(t===e,t,n,""+e),t))(e))}.bind(We),ft=function(){return Oe(this,Je,{minimum:$e,maximum:Ze,integer:et,unique:at})}.bind(We),ht=function(e){return Oe(this,Le(e),{nonEmpty:rt})}.bind(We),yt=function(e){return Oe(this,Be(e),ct(e))}.bind(We),vt=function(){return Oe(this,Xe,{regexp:ot,domain:Ye,nonEmpty:tt,unique:at,matches:it})}.bind(We),wt=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return dt(t.map(mt),"one of these values: "+JSON.stringify(t))};var bt=ht(ut(yt({authenticatedState:wt("ambiguous","authenticated","loggedOut"),id:vt(),namespace:yt({code:vt()}).noUnknownFields(),primary:pt(),xid:vt()}).noUnknownFields()).required()),Et=yt({}),Ct="alloy_debug",It=e=>{let{console:t,locationSearch:n,createLogger:r,instanceName:o,createNamespacedStorage:i,getMonitors:a}=e;const s=me.parse(n),c=i("instance."+o+"."),d=c.session.getItem("debug");let l="true"===d,u=null===d;const p=()=>l,g=(e,t)=>{let{fromConfig:n}=t;n&&!u||(l=e),n||(c.session.setItem("debug",e.toString()),u=!1)};var m;return void 0!==s[Ct]&&g((m=s[Ct],ie(m)&&"true"===m.toLowerCase()),{fromConfig:!1}),{setDebugEnabled:g,logger:r({getDebugEnabled:p,context:{instanceName:o},getMonitors:a,console:t}),createComponentLogger:e=>r({getDebugEnabled:p,context:{instanceName:o,componentName:e},getMonitors:a,console:t})}};const kt=["onComponentsRegistered","onBeforeEvent","onBeforeRequest","onResponse","onRequestFailure","onClick","onDecision"];var St=e=>kt.reduce(((t,n)=>{var r;return t[n]=(r=((e,t)=>function(){for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return Promise.all(e.getLifecycleCallbacks(t).map((e=>new Promise((t=>{t(e(...r))})))))})(e,n),function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Promise.resolve().then((()=>r(...t)))}),t}),{});const Dt=(e,t)=>function(){let n;try{n=e(...arguments)}catch(e){throw ve({error:e,message:t})}return n instanceof Promise&&(n=n.catch((e=>{throw ve({error:e,message:t})}))),n};var Pt=()=>{const e={},t={},n={};return{register(r,o){const{commands:i,lifecycle:a}=o;!function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=(o=Object.keys(t),i=Object.keys(n),o.filter((e=>i.includes(e))));var o,i;if(r.length)throw new Error("[ComponentRegistry] Could not register "+e+" because it has existing command(s): "+r.join(","));Object.keys(n).forEach((r=>{const o=n[r];o.commandName=r,o.run=Dt(o.run,"["+e+"] An error occurred while executing the "+r+" command."),t[r]=o}))}(r,i),function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object.keys(t).forEach((r=>{n[r]=n[r]||[],n[r].push(Dt(t[r],"["+e+"] An error occurred while executing the "+r+" lifecycle hook."))}))}(r,a),e[r]=o},getCommand:e=>t[e],getCommandNames:()=>Object.keys(t),getLifecycleCallbacks:e=>n[e]||[],getComponentNames:()=>Object.keys(e)}};const Tt="in",Rt="out",Ot="pending",Nt="general",At="declinedConsent",Mt="default",xt="initial",qt="new",Lt=e=>{const t=new Error(e);return t.code=At,t.message=e,t};var Ut=e=>{let{logger:t}=e;const n=[],r=()=>Promise.resolve(),o=()=>Promise.resolve(),i=()=>Promise.reject(Lt("No consent preferences have been set.")),a=()=>Promise.reject(Lt("The user declined consent.")),s=e=>{if(e)return Promise.reject(new Error("Consent is pending."));const t=l();return n.push(t),t.promise};return{in(e){e===Mt?this.awaitConsent=r:(e===xt?t.info("Loaded user consent preferences. The user previously consented."):e===qt&&this.awaitConsent!==o&&t.info("User consented."),(()=>{for(;n.length;)n.shift().resolve()})(),this.awaitConsent=o)},out(e){e===Mt?(t.warn("User consent preferences not found. Default consent of out will be used."),this.awaitConsent=i):(e===xt?t.warn("Loaded user consent preferences. The user previously declined consent."):e===qt&&this.awaitConsent!==a&&t.warn("User declined consent."),(()=>{for(;n.length;)n.shift().reject(Lt("The user declined consent."))})(),this.awaitConsent=a)},pending(e){e===Mt&&t.info("User consent preferences not found. Default consent of pending will be used. Some commands may be delayed."),this.awaitConsent=s},awaitConsent:()=>Promise.resolve(),withConsent(){return this.awaitConsent(!0)},current(){switch(this.awaitConsent){case r:return{state:"in",wasSet:!1};case o:return{state:"in",wasSet:!0};case i:return{state:"out",wasSet:!1};case a:return{state:"out",wasSet:!0};case s:return{state:"pending",wasSet:!1};default:return{state:"in",wasSet:!1}}}}};const jt=e=>e&&e._experience&&e._experience.decisioning&&w(e._experience.decisioning.propositions)?e._experience.decisioning.propositions:[];var Bt=()=>{const e={};let t,n,r=!1,o=!1,i=!0;const s=e=>{if(o)throw new Error(e+" cannot be called after event is finalized.")},c={hasQuery(){return Object.prototype.hasOwnProperty.call(this.getContent(),"query")},getContent(){const r=JSON.parse(JSON.stringify(e));return t&&a(r,{xdm:t}),n&&a(r,{data:n}),r},setUserXdm(e){s("setUserXdm"),t=e},setUserData(e){s("setUserData"),n=e},mergeXdm(t){s("mergeXdm"),t&&a(e,{xdm:t})},mergeData(t){s("mergeData"),t&&a(e,{data:t})},mergeMeta(t){s("mergeMeta"),t&&a(e,{meta:t})},mergeQuery(t){s("mergeQuery"),t&&a(e,{query:t})},documentMayUnload(){r=!0},finalize(r){if(o)return;const a=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:u;return e.filter(((n,r)=>((e,t,n)=>{for(let r=0;r<e.length;r+=1)if(n(e[r],t))return r;return-1})(e,n,t)===r))}([...jt(t),...jt(e.xdm)],((e,t)=>e===t||e.id&&t.id&&e.id===t.id&&e.scope&&t.scope&&e.scope===t.scope));if(t&&this.mergeXdm(t),a.length>0&&(e.xdm._experience.decisioning.propositions=a),n&&c.mergeData(n),o=!0,r){i=!1;const t={xdm:e.xdm||{},data:e.data||{}},n=r(t);i=!1!==n,e.xdm=t.xdm||{},e.data=t.data||{},q(e.xdm)&&delete e.xdm,q(e.data)&&delete e.data}},getDocumentMayUnload:()=>r,isEmpty:()=>q(e)&&(!t||q(t))&&(!n||q(n)),shouldSend:()=>i,getViewName(){if(t&&t.web&&t.web.webPageDetails)return t.web.webPageDetails.viewName},toJSON(){if(!o)throw new Error("toJSON called before finalize");return e}};return c};const Ft="configure",_t="setDebug";var Vt=e=>{let n,{logger:r,configureCommand:o,setDebugCommand:i,handleError:a,validateCommandOptions:s}=e;return function(e){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise((t=>{const a=((e,t)=>{let a;if(e===Ft){if(n)throw new Error("The library has already been configured and may only be configured once.");a=()=>(n=o(t),n.then((()=>{})))}else{if(!n)throw new Error("The library must be configured first. Please do so by executing the configure command.");a=e===_t?()=>{const e=yt({enabled:pt().required()}).noUnknownFields(),n=s({command:{commandName:_t,optionsValidator:e},options:t});i(n)}:()=>n.then((n=>{const r=n.getCommand(e);if(!r||!v(r.run)){const t=[Ft,_t].concat(n.getCommandNames()).join(", ");throw new Error("The "+e+" command does not exist. List of available commands: "+t+".")}const o=s({command:r,options:t});return r.run(o)}),(()=>(r.warn("An error during configuration is preventing the "+e+" command from executing."),new Promise((()=>{})))))}return a})(e,c);r.logOnBeforeCommand({commandName:e,options:c}),t(a())})).catch((t=>a(t,e+" command"))).catch((t=>{throw r.logOnCommandRejected({commandName:e,options:c,error:t}),t})).then((n=>{const o=t(n)?n:{};return r.logOnCommandResolved({commandName:e,options:c,result:o}),o}))}};const Ht="https://adobe.ly/3sHgQHb";var zt=e=>{let{command:t,options:n}=e;const{commandName:r,documentationUri:o=Ht,optionsValidator:i}=t;let a=n;if(i)try{a=i(n)}catch(e){throw new Error("Invalid "+r+" command options:\n\t - "+e+" For command documentation see: "+o)}return a};var Jt=e=>{let{options:t,componentCreators:n,coreConfigValidators:r,createConfig:o,logger:i,setDebugEnabled:a}=e;const s=(e=>{const t=[],n={get enabled(){return e.enabled},flush(){t.forEach((t=>{let{method:n,args:r}=t;return e[n](...r)}))}};return Object.keys(e).filter((t=>"function"==typeof e[t])).forEach((e=>{n[e]=function(){for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];t.push({method:e,args:r})}})),n})(i),c=n.map((e=>{let{configValidators:t}=e;return t})).filter((e=>e)).reduce(((e,t)=>e.concat(t)),r),d=o((e=>{let{combinedConfigValidator:t,options:n,logger:r}=e;try{return t.noUnknownFields().required().call({logger:r},n)}catch(e){throw new Error("Resolve these configuration problems:\n\t - "+e.message.split("\n").join("\n\t - ")+"\nFor configuration documentation see: https://adobe.ly/3sHh553")}})({combinedConfigValidator:c,options:t,logger:s}));a(d.debugEnabled,{fromConfig:!0}),s.flush();const l=((e,t,n)=>n.reduce(((n,r)=>{let{buildOnInstanceConfiguredExtraParams:o}=r;return o&&(n={...n,...o({config:e,logger:t})}),n}),{}))(d,i,n);return i.logOnInstanceConfigured({...l,config:d}),d};const Gt=e=>({...e});var Qt=e=>{let{errorPrefix:t,logger:n}=e;return(e,r)=>{const o=he(e);if(o.code===At)return n.warn("The "+r+" could not fully complete. "+o.message),{};throw ye({error:o,message:t+" "+o.message}),o}},Xt=e=>{let{getDebugEnabled:t,console:n,getMonitors:r,context:o}=e,i="["+o.instanceName+"]";o.componentName&&(i+=" ["+o.componentName+"]");const a=(e,t)=>{const n=r();if(n.length>0){const r={...o,...t};n.forEach((t=>{t[e]&&t[e](r)}))}},s=function(e){for(var r=arguments.length,o=new Array(r>1?r-1:0),s=1;s<r;s++)o[s-1]=arguments[s];a("onBeforeLog",{level:e,arguments:o}),t()&&n[e](i,...o)};return{get enabled(){return r().length>0||t()},logOnInstanceCreated(e){a("onInstanceCreated",e),s("info","Instance initialized.")},logOnInstanceConfigured(e){a("onInstanceConfigured",e),s("info","Instance configured. Computed configuration:",e.config)},logOnBeforeCommand(e){a("onBeforeCommand",e),s("info","Executing "+e.commandName+" command. Options:",e.options)},logOnCommandResolved(e){a("onCommandResolved",e),s("info",e.commandName+" command resolved. Result:",e.result)},logOnCommandRejected(e){a("onCommandRejected",e),s("error",e.commandName+" command was rejected. Error:",e.error)},logOnBeforeNetworkRequest(e){a("onBeforeNetworkRequest",e),s("info","Request "+e.requestId+": Sending request.",e.payload)},logOnNetworkResponse(e){a("onNetworkResponse",e);const t=e.parsedBody||e.body?"response body:":"no response body.";s("info","Request "+e.requestId+": Received response with status code "+e.statusCode+" and "+t,e.parsedBody||e.body)},logOnNetworkError(e){a("onNetworkError",e),s("error","Request "+e.requestId+": Network request failed.",e.error)},logOnContentHiding(e){a("onContentHiding",{status:e.status}),s(e.logLevel,e.message)},logOnContentRendering(e){a("onContentRendering",{status:e.status,payload:e.detail}),s(e.logLevel,e.message)},info:s.bind(null,"info"),warn:s.bind(null,"warn"),error:s.bind(null,"error")}},Wt="__view__",Yt=e=>(t,n)=>{e.xdm=e.xdm||{},e.xdm.identityMap=e.xdm.identityMap||{},e.xdm.identityMap[t]=e.xdm.identityMap[t]||[],e.xdm.identityMap[t].push(n)},Kt=e=>{const{payload:t,getAction:n,getUseSendBeacon:r,datastreamIdOverride:o,edgeSubPath:i}=e,a=Se();let s=!1,c=!1;return{getId:()=>a,getPayload:()=>t,getAction:()=>n({isIdentityEstablished:c}),getDatastreamIdOverride:()=>o,getUseSendBeacon:()=>r({isIdentityEstablished:c}),getEdgeSubPath:()=>i||"",getUseIdThirdPartyDomain:()=>s,setUseIdThirdPartyDomain(){s=!0},setIsIdentityEstablished(){c=!0}}},$t=e=>{let{payload:t,datastreamIdOverride:n}=e;const r=e=>{let{isIdentityEstablished:n}=e;return t.getDocumentMayUnload()&&n};return Kt({payload:t,getAction(e){let{isIdentityEstablished:t}=e;return r({isIdentityEstablished:t})?"collect":"interact"},getUseSendBeacon:r,datastreamIdOverride:n})},Zt=t=>{const{content:n,addIdentity:r,hasIdentity:o}=t,i=s(n,"meta.configOverrides");return{mergeMeta:s(n,"meta"),mergeState:s(n,"meta.state"),mergeQuery:s(n,"query"),mergeConfigOverride:t=>i((t=>{if(e(t)||"object"!=typeof t)return null;const n=L(t,(t=>!(e(t)||!ne(t)&&!re(t)&&!ae(t)&&!w(t))));return q(n)?null:n})(t)),addIdentity:r,hasIdentity:o,toJSON:()=>n}},en=e=>t=>void 0!==(e.xdm&&e.xdm.identityMap&&e.xdm.identityMap[t]),tn=()=>{const e={},t=Zt({content:e,addIdentity:Yt(e),hasIdentity:en(e)});return t.addEvent=t=>{e.events=e.events||[],e.events.push(t)},t.getDocumentMayUnload=()=>(e.events||[]).some((e=>e.getDocumentMayUnload())),t},nn=e=>{let{localConfigOverrides:t,globalConfigOverrides:n,payload:r}=e;const o={payload:r},{datastreamId:i,...a}=t||{};return i&&(o.datastreamIdOverride=i),n&&!q(n)&&r.mergeConfigOverride(n),a&&!q(a)&&r.mergeConfigOverride(a),o};const rn="clientId";const on="Event was canceled because the onBeforeEventSend callback returned false.";var an=e=>{let{orgId:t,targetMigrationEnabled:n}=e;return e=>((e,t)=>0===t.indexOf(F+"_"+_(e)+"_"))(t,e)||"at_qa_mode"===e||n&&"mbox"===e};var sn=e=>function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return n.length<2?Object.assign(...n):n.reduce(((e,n)=>(t(n)&&Object.keys(n).forEach((t=>{Array.isArray(n[t])?Array.isArray(e[t])?e[t].push(...n[t]):e[t]=[...n[t]]:e[t]=n[t]})),e)))}({},...e.shift()||[],...e.shift()||[],...e),cn=e=>t=>{const n=()=>{throw t};return e.call({error:t}).then(n,n)};const dn="The server responded with a";var ln=e=>{let{orgId:t,cookieJar:n}=e;const r=V(t,"cluster");return()=>n.get(r)||(()=>{const e=n.get("mboxEdgeCluster");if(e)return"t"+e})()};const un=[429,503,502,504];var pn=e=>{let{response:t,retriesAttempted:n}=e;return n<3&&un.includes(t.statusCode)};var gn=e=>{let{response:t,retriesAttempted:n}=e,r=(e=>{const t=e.getHeader("Retry-After");let n;if(t){const e=parseInt(t,10);n=oe(e)?1e3*e:Math.max(0,new Date(t).getTime()-(new Date).getTime())}return n})(t);return void 0===r&&(r=(e=>{const t=1e3+1e3*e,n=.3*t,r=t-n,o=t+n;return Math.round(r+Math.random()*(o-r))})(n)),r};var mn=e=>{let t=window.__alloyMonitors||[];return e&&(t=t.concat(e)),t};var fn=e=>t=>{const n=e().toISOString();a(t,{timestamp:n})},hn="2.27.0",yn=[["architecture","string"],["bitness","string"],["model","string"],["platformVersion","string"],["wow64","boolean"]];const vn=(e=>t=>{const n={webPageDetails:{URL:e.location.href||e.location},webReferrer:{URL:e.document.referrer}};a(t,{web:n})})(window),wn=(e=>t=>{const{screen:{width:n,height:r}}=e,o={},i=we(r);i>=0&&(o.screenHeight=i);const s=we(n);s>=0&&(o.screenWidth=s);const c=(e=>{const{screen:{orientation:t}}=e;if(null==t||null==t.type)return null;const n=t.type.split("-");return 0===n.length||"portrait"!==n[0]&&"landscape"!==n[0]?null:n[0]})(e)||(e=>{if(v(e.matchMedia)){if(e.matchMedia("(orientation: portrait)").matches)return"portrait";if(e.matchMedia("(orientation: landscape)").matches)return"landscape"}return null})(e);c&&(o.screenOrientation=c),Object.keys(o).length>0&&a(t,{device:o})})(window),bn=(e=>t=>{const{document:{documentElement:{clientWidth:n,clientHeight:r}={}}}=e,o={type:"browser"},i=we(n);i>=0&&(o.browserDetails={viewportWidth:i});const s=we(r);s>=0&&(o.browserDetails=o.browserDetails||{},o.browserDetails.viewportHeight=s),a(t,{environment:o})})(window),En=(Cn=()=>new Date,e=>{const t=Cn(),n={},r=we(t.getTimezoneOffset());void 0!==r&&(n.localTimezoneOffset=r),(void 0===r||Math.abs(r)<6e3)&&(n.localTime=(e=>{const t=e.getFullYear(),n=be(e.getMonth()+1,2,"0"),r=be(e.getDate(),2,"0"),o=be(e.getHours(),2,"0"),i=be(e.getMinutes(),2,"0"),a=be(e.getSeconds(),2,"0"),s=be(e.getMilliseconds(),3,"0"),c=we(e.getTimezoneOffset(),0);return t+"-"+n+"-"+r+"T"+o+":"+i+":"+a+"."+s+(c>0?"-":"+")+be(Math.floor(Math.abs(c)/60),2,"0")+":"+be(Math.abs(c)%60,2,"0")})(t)),a(e,{placeContext:n})});var Cn;const In=fn((()=>new Date)),kn={web:vn,device:wn,environment:bn,placeContext:En},Sn={highEntropyUserAgentHints:(e=>(e=>"userAgentData"in e)(e)?(t,n)=>{try{return e.userAgentData.getHighEntropyValues(yn.map((e=>e[0]))).then((e=>{const n={};yn.forEach((t=>{let[r,o]=t;Object.prototype.hasOwnProperty.call(e,r)&&typeof e[r]===o&&(n[r]=e[r])})),a(t,{environment:{browserDetails:{userAgentClientHints:n}}})}))}catch(e){return n.warn("Unable to collect user-agent client hints. "+e.message),se}}:se)(navigator)},Dn={...kn,...Sn},Pn=[In,e=>{a(e,{implementationDetails:{name:"https://ns.adobe.com/experience/alloy",version:hn,environment:"browser"}})}],Tn=e=>{let{config:t,logger:n}=e;return((e,t,n,r)=>{const o=e.context.flatMap(((e,r)=>n[e]?[n[e]]:(t.warn("Invalid context["+r+"]: '"+e+"' is not available."),[]))).concat(r);return{namespace:"Context",lifecycle:{onBeforeEvent(e){let{event:n}=e;const r={};return Promise.all(o.map((e=>Promise.resolve(e(r,t))))).then((()=>n.mergeXdm(r)))}}}})(t,n,Dn,Pn)};Tn.namespace="Context",Tn.configValidators=yt({context:ut(vt()).default(Object.keys(kn))});const Rn=e=>{let{eventManager:t,logger:n}=e;return{commands:{sendEvent:{documentationUri:"https://adobe.ly/3GQ3Q7t",optionsValidator:e=>(e=>{let{options:t}=e;return yt({type:vt(),xdm:yt({eventType:vt(),identityMap:bt}),data:yt({}),documentUnloading:pt(),renderDecisions:pt(),decisionScopes:ut(vt()).uniqueItems(),personalization:yt({decisionScopes:ut(vt()).uniqueItems(),surfaces:ut(vt()).uniqueItems(),sendDisplayEvent:pt().default(!0),includeRenderedPropositions:pt().default(!1),defaultPersonalizationEnabled:pt(),decisionContext:yt({})}).default({sendDisplayEvent:!0}),datasetId:vt(),mergeId:vt(),edgeConfigOverrides:Et}).required().noUnknownFields()(t)})({options:e}),run:e=>{const{xdm:r,data:o,documentUnloading:i,type:s,mergeId:c,datasetId:d,edgeConfigOverrides:l,...u}=e,p=t.createEvent();return i&&p.documentMayUnload(),p.setUserXdm(r),p.setUserData(o),s&&p.mergeXdm({eventType:s}),c&&p.mergeXdm({eventMergeId:c}),l&&(u.edgeConfigOverrides=l),d&&(n.warn("The 'datasetId' option has been deprecated. Please use 'edgeConfigOverrides.com_adobe_experience_platform.datasets.event.datasetId' instead."),u.edgeConfigOverrides=l||{},a(u.edgeConfigOverrides,{com_adobe_experience_platform:{datasets:{event:{datasetId:d}}}})),t.sendEvent(p,u)}},applyResponse:{documentationUri:"",optionsValidator:e=>(e=>{let{options:t}=e;return yt({renderDecisions:pt(),responseHeaders:ht(vt().required()),responseBody:yt({handle:ut(yt({type:vt().required(),payload:lt().required()})).required()}).required(),personalization:yt({sendDisplayEvent:pt().default(!0),decisionContext:yt({})}).default({sendDisplayEvent:!0})}).noUnknownFields()(t)})({options:e}),run:e=>{const{renderDecisions:n=!1,decisionContext:r={},responseHeaders:o={},responseBody:i={handle:[]},personalization:a}=e,s=t.createEvent();return t.applyResponse(s,{renderDecisions:n,decisionContext:r,responseHeaders:o,responseBody:i,personalization:a})}}}}};Rn.namespace="DataCollector";const On=(e,t)=>"ID sync "+(t?"succeeded":"failed")+": "+e.spec.url;const Nn=yt({thirdPartyCookiesEnabled:pt().default(!0),idMigrationEnabled:pt().default(!0)});var An=yt({url:vt().required().nonEmpty(),edgeConfigOverrides:Et}).required().noUnknownFields(),Mn="ECID",xn=e=>{let{logger:n}=e;return new Promise(((e,r)=>{if(t(window.adobe)&&t(window.adobe.optIn)){const t=window.adobe.optIn;n.info("Delaying request while waiting for legacy opt-in to let Visitor retrieve ECID from server."),t.fetchPermissions((()=>{t.isApproved([t.Categories.ECID])?(n.info("Received legacy opt-in approval to let Visitor retrieve ECID from server."),e()):r(new Error("Legacy opt-in was declined."))}),!0)}else e()}))},qn=e=>{let{logger:t,orgId:n,awaitVisitorOptIn:r}=e;return()=>{const e=(e=>{const t=e.Visitor;return v(t)&&v(t.getInstance)&&t})(window);return e?r({logger:t}).then((()=>(t.info("Delaying request while using Visitor to retrieve ECID from server."),new Promise((r=>{e.getInstance(n,{}).getMarketingCloudVisitorID((e=>{t.info("Resuming previously delayed request that was waiting for ECID from Visitor."),r(e)}),!0)}))))).catch((e=>{e?t.info(e.message+", retrieving ECID from experience edge"):t.info("An error occurred while obtaining the ECID from Visitor.")})):Promise.resolve()}},Ln="CORE",Un=e=>{try{return decodeURIComponent(e)}catch{return""}};var jn=(e,t)=>{e.addIdentity(Mn,{id:t})},Bn=e=>e.getPayloadsByType("identity:result").reduce(((e,t)=>(t.namespace&&t.namespace.code&&(e[t.namespace.code]=t.id),e)),{}),Fn=e=>{let{payload:t,datastreamIdOverride:n}=e;return Kt({payload:t,datastreamIdOverride:n,getAction:()=>"identity/acquire",getUseSendBeacon:()=>!1})},_n=e=>{const t={query:{identity:{fetch:e}}};return Zt({content:t,addIdentity:Yt(t),hasIdentity:en(t)})};const Vn=/^([^?#]*)(\??[^#]*)(#?.*)$/;const Hn=yt({namespaces:ut(wt(Mn,Ln)).nonEmpty().uniqueItems().default([Mn]),edgeConfigOverrides:Et}).noUnknownFields().default({namespaces:[Mn]});const zn=(e,t)=>{let n,r=0,o=0;do{if(t<0||t+o>=e.length)throw new Error("Invalid varint: buffer ended unexpectedly");if(n=e[t+o],r|=(127&n)<<7*o,o+=1,o>10)throw new Error("Invalid varint: too long")}while(128&n);return{value:r,length:o}},Jn=Object.freeze({VARINT:0,I64:1,LEN:2,SGROUP:3,EGROUP:4,I32:5});var Gn=e=>{let{orgId:t,cookieJar:n,logger:r}=e;const o=V(t,"identity");return()=>{const e=n.get(o);if(!e)return null;try{const t=decodeURIComponent(e).replace(/_/g,"/").replace(/-/g,"+");return(e=>{let t=0,n=null;for(;t<e.length&&!n;){const{value:r,length:o}=zn(e,t);t+=o;const i=7&r;if(1==r>>3){if(i===Jn.LEN){const r=zn(e,t);return t+=r.length,n=(new TextDecoder).decode(e.slice(t,t+r.value)),t+=r.value,n}}else switch(i){case Jn.VARINT:t+=zn(e,t).length;break;case Jn.I64:t+=8;break;case Jn.LEN:{const n=zn(e,t);t+=n.length+n.value;break}case Jn.SGROUP:case Jn.EGROUP:break;case Jn.I32:t+=4;break;default:throw new Error("Malformed kndctr cookie. Unknown wire type: "+i)}}throw new Error("No ECID found in cookie.")})((e=>{const t=atob(e);return Uint8Array.from(t,(e=>e.codePointAt(0)))})(t))}catch(e){return r.warn("Unable to decode ECID from "+o+" cookie",e),null}}};const Qn=e=>{let{config:t,logger:n,consent:r,fireReferrerHideableImage:i,sendEdgeNetworkRequest:a,apexDomain:s,getBrowser:c}=e;const{orgId:l,thirdPartyCookiesEnabled:u,edgeConfigOverrides:p}=t,g=qn({logger:n,orgId:l,awaitVisitorOptIn:xn}),m=d({logger:n,cookieJar:o}),f=(e=>{let{config:t,getEcidFromVisitor:n,apexDomain:r,isPageSsl:o,cookieJar:i}=e;const{idMigrationEnabled:a,orgId:s}=t,c="AMCV_"+s,d=()=>{let e=null;const t=i.get("s_ecid")||i.get(c);if(t){const n=/(^|\|)MCMID\|(\d+)($|\|)/,r=t.match(n);r&&(e=r[2])}return e};return{getEcid(){if(a){const e=d();return e?Promise.resolve(e):n()}return Promise.resolve()},setEcid(e){if(a&&d()!==e){const t=o?{sameSite:"none",secure:!0}:{};i.set(c,"MCMID|"+e,{domain:r,expires:390,...t})}}}})({config:t,getEcidFromVisitor:g,apexDomain:s,cookieJar:m,isPageSsl:"https:"===window.location.protocol}),h=Z({orgId:l}),y=(e=>{let{sendEdgeNetworkRequest:t,createIdentityRequestPayload:n,createIdentityRequest:r,globalConfigOverrides:o}=e;return function(){let{namespaces:e,edgeConfigOverrides:i}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const a=nn({payload:n(e),globalConfigOverrides:o,localConfigOverrides:i}),s=r(a);return t({request:s})}})({sendEdgeNetworkRequest:a,createIdentityRequestPayload:_n,createIdentityRequest:Fn,globalConfigOverrides:p}),v=(e=>{let{getBrowser:t}=e;return K((()=>$.includes(t())))})({getBrowser:c}),w=(e=>{let{thirdPartyCookiesEnabled:t,areThirdPartyCookiesSupportedByDefault:n}=e;return e=>{t&&n()&&e.setUseIdThirdPartyDomain()}})({thirdPartyCookiesEnabled:u,areThirdPartyCookiesSupportedByDefault:v}),b=(e=>{let{getLegacyEcid:t,addEcidToPayload:n}=e;return e=>e.hasIdentity(Mn)?Promise.resolve():t().then((t=>{t&&n(e,t)}))})({getLegacyEcid:f.getEcid,addEcidToPayload:jn}),E=(e=>{let{locationSearch:t,dateProvider:n,orgId:r,logger:o}=e;return e=>{if(e.hasIdentity(Mn))return;let i=me.parse(t).adobe_mc;if(void 0===i)return;Array.isArray(i)&&(o.warn("Found multiple adobe_mc query string paramters, only using the last one."),i=i[i.length-1]);const a=i.split("|").reduce(((e,t)=>{const[n,r]=t.split("=");return e[n]=Un(r),e[n]=e[n].replace(/[^a-zA-Z0-9@.]/g,""),e}),{}),s=parseInt(a.TS,10),c=a.MCMID,d=Un(a.MCORGID);n().getTime()/1e3<=s+300&&d===r&&c?(o.info("Found valid ECID identity "+c+" from the adobe_mc query string parameter."),e.addIdentity(Mn,{id:c})):o.info("Detected invalid or expired adobe_mc query string parameter.")}})({locationSearch:window.document.location.search,dateProvider:()=>new Date,orgId:l,logger:n}),C=(e=>{let{doesIdentityCookieExist:t,orgId:n,logger:r}=e;return e=>{let{onResponse:o,onRequestFailure:i}=e;return new Promise(((e,a)=>{o((()=>{t()?e():(r.warn("Identity cookie not found. This could be caused by any of the following issues:\n\t* The org ID "+n+" configured in Alloy doesn't match the org ID specified in the edge configuration.\n\t* Experience edge was not able to set the identity cookie due to domain or cookie restrictions.\n\t* The request was canceled by the browser and not fully processed."),a(new Error("Identity cookie not found.")))})),i((()=>{t()?e():a(new Error("Identity cookie not found."))}))}))}})({doesIdentityCookieExist:h,orgId:l,logger:n}),I=(e=>{let t,{doesIdentityCookieExist:n,setDomainForInitialIdentityPayload:r,addLegacyEcidToPayload:o,awaitIdentityCookie:i,logger:a}=e;const s=e=>(r(e),o(e.getPayload()));return e=>{let{request:r,onResponse:o,onRequestFailure:c}=e;if(n())return r.setIsIdentityEstablished(),Promise.resolve();if(t){a.info("Delaying request while retrieving ECID from server.");const e=t;return t=e.catch((()=>i({onResponse:o,onRequestFailure:c}))),e.then((()=>{a.info("Resuming previously delayed request."),r.setIsIdentityEstablished()})).catch((()=>s(r)))}return t=i({onResponse:o,onRequestFailure:c}),t.catch((()=>{})),s(r)}})({doesIdentityCookieExist:h,setDomainForInitialIdentityPayload:w,addLegacyEcidToPayload:b,awaitIdentityCookie:C,logger:n}),k=(e=>{let{fireReferrerHideableImage:t,logger:n}=e;return e=>{const r=e.filter((e=>"url"===e.type));return r.length?Promise.all(r.map((e=>t(e.spec).then((()=>{n.info(On(e,!0))})).catch((()=>{n.error(On(e,!1))}))))).then(se):Promise.resolve()}})({fireReferrerHideableImage:i,logger:n}),S=(e=>{let{processIdSyncs:t}=e;return e=>t(e.getPayloadsByType("identity:exchange"))})({processIdSyncs:k}),D=(e=>{let{dateProvider:t,orgId:n}=e;return(e,r)=>{const o=Math.round(t().getTime()/1e3),i=encodeURIComponent("TS="+o+"|MCMID="+e+"|MCORGID="+encodeURIComponent(n)),[,a,s,c]=r.match(Vn),d=(e=>""===e?"?":"?"===e?"":"&")(s);return""+a+s+d+"adobe_mc="+i+c}})({dateProvider:()=>new Date,orgId:l}),P=(e=>{let{thirdPartyCookiesEnabled:t}=e;return e=>{const n=Hn(e);if(!t&&n.namespaces.includes(Ln))throw new Error("namespaces: The CORE namespace cannot be requested when third-party cookies are disabled.");return n}})({thirdPartyCookiesEnabled:u}),T=(e=>{let{thirdPartyCookiesEnabled:t,areThirdPartyCookiesSupportedByDefault:n}=e;const r={identity:{fetch:[Mn]}};return t&&n()&&r.identity.fetch.push(Ln),e=>{e.mergeQuery(r)}})({thirdPartyCookiesEnabled:u,areThirdPartyCookiesSupportedByDefault:v}),R=Gn({orgId:l,cookieJar:m,logger:n});return(e=>{let t,{addEcidQueryToPayload:n,addQueryStringIdentityToPayload:r,ensureSingleIdentity:o,setLegacyEcid:i,handleResponseForIdSyncs:a,getNamespacesFromResponse:s,getIdentity:c,consent:d,appendIdentityToUrl:l,logger:u,getIdentityOptionsValidator:p,decodeKndctrCookie:g}=e,m={};return{lifecycle:{onBeforeRequest(e){let{request:t,onResponse:i,onRequestFailure:a}=e;return n(t.getPayload()),r(t.getPayload()),o({request:t,onResponse:i,onRequestFailure:a})},onResponse(e){let{response:n}=e;const r=s(n);return t&&t[Mn]||!r||!r[Mn]||i(r[Mn]),r&&Object.keys(r).length>0&&(t={...t,...r}),m={...m,...n.getEdge()},a(n)}},commands:{getIdentity:{optionsValidator:p,run:e=>{const{namespaces:n}=e;return d.awaitConsent().then((()=>{if(t)return;const r=g();return r&&n.includes(Mn)&&(t||(t={}),t[Mn]=r,1===n.length)?void 0:c(e)})).then((()=>({identity:n.reduce(((e,n)=>(e[n]=t[n]||null,e)),{}),edge:m})))}},appendIdentityToUrl:{optionsValidator:An,run:e=>d.withConsent().then((()=>{if(t)return;const n=g();return n?(t||(t={}),void(t[Mn]=n)):c(e)})).then((()=>({url:l(t[Mn],e.url)}))).catch((t=>(u.warn("Unable to append identity to url. "+t.message),e)))}}}})({addEcidQueryToPayload:T,addQueryStringIdentityToPayload:E,ensureSingleIdentity:I,setLegacyEcid:f.setEcid,handleResponseForIdSyncs:S,getNamespacesFromResponse:Bn,getIdentity:y,consent:r,appendIdentityToUrl:D,logger:n,getIdentityOptionsValidator:P,decodeKndctrCookie:R})};Qn.namespace="Identity",Qn.configValidators=Nn;const Xn=e=>{let{config:t,componentRegistry:n}=e;const r=[...n.getCommandNames(),Ft,_t].sort(),o={...t};Object.keys(t).forEach((e=>{const n=t[e];"function"==typeof n&&(o[e]=n.toString())}));const i=n.getComponentNames();return{version:hn,configs:o,commands:r,components:i}},Wn=e=>{let{config:t,componentRegistry:n}=e;return{commands:{getLibraryInfo:{run:()=>({libraryInfo:Xn({config:t,componentRegistry:n})})}}}};Wn.namespace="LibraryInfo";var Yn=Object.freeze({__proto__:null,context:Tn,dataCollector:Rn,identity:Qn,libraryInfo:Wn});const Kn=te(window),{console:$n,fetch:Zn,navigator:er}=window,tr=yt({debugEnabled:pt().default(!1),datastreamId:vt().unique().required(),edgeDomain:vt().domain().default("edge.adobedc.net"),edgeBasePath:vt().nonEmpty().default("ee"),orgId:vt().unique().required(),onBeforeEventSend:gt().default(se),edgeConfigOverrides:Et}).renamed("edgeConfigId",vt().unique(),"datastreamId"),nr=((e,t)=>{let n="";const r=e.location.hostname.toLowerCase().split(".");let o=1;for(;o<r.length&&!t.get(B);)o+=1,n=(i=r,a=o,i.slice(-a)).join("."),t.set(B,B,{domain:n});var i,a;return t.remove(B,{domain:n}),n})(window,o),rr=(e=>{let{fetch:t}=e;return(e,n)=>t(e,{method:"POST",cache:"no-cache",credentials:"include",headers:{"Content-Type":"text/plain; charset=UTF-8"},referrerPolicy:"no-referrer-when-downgrade",body:n}).then((e=>e.text().then((t=>({statusCode:e.status,getHeader:t=>e.headers.get(t),body:t})))))})({fetch:Zn}),or=function(){let{appendNode:e=p,awaitSelector:t=N,createNode:n=g,fireImage:r=y}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const o=r;let i;const a=o=>{let{src:a}=o;return t("BODY").then((t=>{let[r]=t;return i||(i=n("IFRAME",M,x),e(r,i))})).then((e=>{const t=e.contentWindow.document;return r({src:a,currentDocument:t})}))};return e=>{const{hideReferrer:t,url:n}=e;return t?a({src:n}):o({src:n})}}(),ir=(e=>{let{window:t,createNamespacedStorage:n}=e;const r=n("validation.");return()=>{const e=me.parse(t.location.search).adb_validation_sessionid;if(!e)return"";const n=(e=>{let t=e.persistent.getItem(rn);return t||(t=Se(),e.persistent.setItem(rn,t)),t})(r),o=e+"|"+n;return"&"+me.stringify({adobeAepValidationToken:o})}})({window:window,createNamespacedStorage:Kn}),ar=(e=>{let{userAgent:t}=e;return K((()=>((e,t)=>{const n=Object.keys(e);for(let r=0;r<n.length;r+=1){const o=n[r];if(e[o].test(t))return o}return Y})({[J]:/Edge\/([0-9\._]+)/,[G]:/Edg\/([0-9\.]+)/,[z]:/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/,[Q]:/Firefox\/([0-9\.]+)(?:\s|$)/,[X]:/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/,[W]:/Version\/([0-9\._]+).*Safari/},t)))})({userAgent:window.navigator.userAgent}),sr=e=>{let{instanceName:t,logController:{setDebugEnabled:n,logger:r,createComponentLogger:i},components:a}=e;const s=Pt(),l=St(s),u=a.concat(Object.values(Yn)),p=d({logger:r,cookieJar:o}),g=Qt({errorPrefix:"["+t+"]",logger:r}),m=Vt({logger:r,configureCommand:e=>{const a=Jt({options:e,componentCreators:u,coreConfigValidators:tr,createConfig:Gt,logger:r,setDebugEnabled:n}),{orgId:d,targetMigrationEnabled:g}=a,m=an({orgId:d,targetMigrationEnabled:g}),f=(e=>{let{cookieJar:t,shouldTransferCookie:n,apexDomain:r,dateProvider:o}=e;return{cookiesToPayload(e,o){const i=""!==r&&o.endsWith(r),a={domain:r,cookiesEnabled:!0};if(!i){const e=t.get(),r=Object.keys(e).filter(n).map((t=>({key:t,value:e[t]})));r.length&&(a.entries=r)}e.mergeState(a)},responseToCookies(e){e.getPayloadsByType("state:store").forEach((e=>{const n={domain:r},i=e.attrs&&e.attrs.SameSite&&e.attrs.SameSite.toLowerCase();void 0!==e.maxAge&&(n.expires=new Date(o().getTime()+1e3*e.maxAge)),void 0!==i&&(n.sameSite=i),"none"===i&&(n.secure=!0),t.set(e.key,e.value,n)}))}}})({cookieJar:p,shouldTransferCookie:m,apexDomain:nr,dateProvider:()=>new Date}),h=v(er.sendBeacon)?(e=>{let{sendBeacon:t,sendFetchRequest:n,logger:r}=e;return(e,o)=>{const i=new Blob([o],{type:"text/plain; charset=UTF-8"});return t(e,i)?Promise.resolve({statusCode:204,getHeader:()=>null,body:""}):(r.info("Unable to use `sendBeacon`; falling back to `fetch`."),n(e,o))}})({sendBeacon:er.sendBeacon.bind(er),sendFetchRequest:rr,logger:r}):rr,y=(e=>{let{logger:t,sendFetchRequest:n,sendBeaconRequest:r,isRequestRetryable:o,getRequestRetryDelay:i}=e;return e=>{let{requestId:a,url:s,payload:c,useSendBeacon:d}=e;const l=JSON.stringify(c),u=JSON.parse(l);t.logOnBeforeNetworkRequest({url:s,requestId:a,payload:u});const p=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(d?r:n)(s,l).then((n=>{if(o({response:n,retriesAttempted:e})){const t=i({response:n,retriesAttempted:e});return new Promise((n=>{setTimeout((()=>{n(p(e+1))}),t)}))}let r;try{r=JSON.parse(n.body)}catch{}return t.logOnNetworkResponse({requestId:a,url:s,payload:u,...n,parsedBody:r,retriesAttempted:e}),{statusCode:n.statusCode,body:n.body,parsedBody:r,getHeader:n.getHeader}}))};return p().catch((e=>{throw t.logOnNetworkError({requestId:a,url:s,payload:u,error:e}),ve({error:e,message:"Network request failed."})}))}})({logger:r,sendFetchRequest:rr,sendBeaconRequest:h,isRequestRetryable:pn,getRequestRetryDelay:gn}),w=(e=>{let{logger:t}=e;return e=>{const{statusCode:n,body:r,parsedBody:o}=e;if(n<200||n>=300||!o&&204!==n||o&&!Array.isArray(o.handle)){const e=o?JSON.stringify(o,null,2):r;throw new Error(dn+" status code "+n+" and "+(e?"response body:\n"+e:"no response body."))}if(o){const{warnings:e=[],errors:n=[]}=o;e.forEach((e=>{t.warn(dn+" warning:",e)})),n.forEach((e=>{t.error(dn+" non-fatal error:",e)}))}}})({logger:r}),b=(e=>{let{logger:t}=e;return e=>{if(e){const n=e.split(";");if(n.length>=2&&n[1].length>0)try{const e=parseInt(n[1],10);if(!Number.isNaN(e))return{regionId:e}}catch{}t.warn('Invalid adobe edge: "'+e+'"')}return{}}})({logger:r}),E=(e=>{let{extractEdgeInfo:t}=e;return e=>{let{content:n={},getHeader:r}=e;const{handle:o=[],errors:i=[],warnings:a=[]}=n;return{getPayloadsByType:e=>o.filter((t=>t.type===e)).flatMap((e=>e.payload)),getErrors:()=>i,getWarnings:()=>a,getEdge:()=>t(r("x-adobe-edge")),toJSON:()=>n}}})({extractEdgeInfo:b}),C=ln({orgId:d,cookieJar:o}),I=(e=>{let{config:t,lifecycle:n,cookieTransfer:r,sendNetworkRequest:o,createResponse:i,processWarningsAndErrors:a,getLocationHint:s,getAssuranceValidationTokenParams:d}=e;const{edgeDomain:l,edgeBasePath:u,datastreamId:p}=t;let g=!1;const m=(e,t)=>{const n=s(),r=n?u+"/"+n+t.getEdgeSubPath():""+u+t.getEdgeSubPath(),o=t.getDatastreamIdOverride()||p;return o!==p&&t.getPayload().mergeMeta({sdkConfig:{datastream:{original:p}}}),"https://"+e+"/"+r+"/v1/"+t.getAction()+"?configId="+o+"&requestId="+t.getId()+d()};return e=>{let{request:t,runOnResponseCallbacks:s=se,runOnRequestFailureCallbacks:d=se}=e;const u=c();u.add(n.onResponse),u.add(s);const p=c();return p.add(n.onRequestFailure),p.add(d),n.onBeforeRequest({request:t,onResponse:u.add,onRequestFailure:p.add}).then((()=>{const e=g||!t.getUseIdThirdPartyDomain()?l:"adobedc.demdex.net",n=m(e,t),i=t.getPayload();return r.cookiesToPayload(i,e),o({requestId:t.getId(),url:n,payload:i,useSendBeacon:t.getUseSendBeacon()})})).then((e=>(a(e),e))).catch((e=>{if(((e,t)=>t.getUseIdThirdPartyDomain()&&(e=>"TypeError"===e.name||"NetworkError"===e.name||0===e.status)(e))(e,t)){g=!0,t.setUseIdThirdPartyDomain(!1);const e=m(l,t),n=t.getPayload();return r.cookiesToPayload(n,l),o({requestId:t.getId(),url:e,payload:n,useSendBeacon:t.getUseSendBeacon()})}return cn(p)(e)})).then((e=>{let{parsedBody:t,getHeader:n}=e;const o=i({content:t,getHeader:n});return r.responseToCookies(o),u.call({response:o}).then(sn)}))}})({config:a,lifecycle:l,cookieTransfer:f,sendNetworkRequest:y,createResponse:E,processWarningsAndErrors:w,getLocationHint:C,getAssuranceValidationTokenParams:ir}),k=(e=>{let{cookieTransfer:t,lifecycle:n,createResponse:r,processWarningsAndErrors:o}=e;return e=>{let{request:i,responseHeaders:a,responseBody:s,runOnResponseCallbacks:d=se,runOnRequestFailureCallbacks:l=se}=e;const u=c();u.add(n.onResponse),u.add(d);const p=c();p.add(n.onRequestFailure),p.add(l);const g=e=>a[e];return n.onBeforeRequest({request:i,onResponse:u.add,onRequestFailure:p.add}).then((()=>o({statusCode:200,getHeader:g,body:JSON.stringify(s),parsedBody:s}))).catch(cn(p)).then((()=>{const e=r({content:s,getHeader:g});return t.responseToCookies(e),u.call({response:e}).then(sn)}))}})({lifecycle:l,cookieTransfer:f,createResponse:E,processWarningsAndErrors:w}),S=(e=>{let{generalConsentState:t,logger:n}=e;const r=(e,r)=>{switch(e[Nt]){case Tt:t.in(r);break;case Rt:t.out(r);break;case Ot:t.pending(r);break;default:n.warn("Unknown consent value: "+e[Nt])}};return{initializeConsent(e,t){t[Nt]?r(t,xt):r(e,Mt)},setConsent(e){r(e,qt)},suspend(){t.pending()},awaitConsent:()=>t.awaitConsent(),withConsent:()=>t.withConsent(),current:()=>t.current()}})({generalConsentState:Ut({logger:r}),logger:r}),D=(e=>{let{config:t,logger:n,lifecycle:r,consent:o,createEvent:i,createDataCollectionRequestPayload:a,createDataCollectionRequest:s,sendEdgeNetworkRequest:d,applyResponse:l}=e;const{onBeforeEventSend:u,edgeConfigOverrides:p}=t;return{createEvent:i,sendEvent(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{edgeConfigOverrides:i,...l}=t,g=nn({payload:a(),localConfigOverrides:i,globalConfigOverrides:p}),m=s(g),f=c(),h=c();return r.onBeforeEvent({...l,event:e,onResponse:f.add,onRequestFailure:h.add}).then((()=>(g.payload.addEvent(e),o.awaitConsent()))).then((()=>{try{e.finalize(u)}catch(e){const t=()=>{throw e};return h.add(r.onRequestFailure),h.call({error:e}).then(t,t)}if(!e.shouldSend()){h.add(r.onRequestFailure),n.info(on);const e=new Error(on);return h.call({error:e}).then((()=>{}))}return d({request:m,runOnResponseCallbacks:f.call,runOnRequestFailureCallbacks:h.call})}))},applyResponse(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{renderDecisions:n=!1,decisionContext:o={},responseHeaders:i={},responseBody:d={handle:[]},personalization:u}=t,p=a(),g=s({payload:p}),m=c();return r.onBeforeEvent({event:e,renderDecisions:n,decisionContext:o,decisionScopes:[Wt],personalization:u,onResponse:m.add,onRequestFailure:se}).then((()=>(p.addEvent(e),l({request:g,responseHeaders:i,responseBody:d,runOnResponseCallbacks:m.call}))))}}})({config:a,logger:r,lifecycle:l,consent:S,createEvent:Bt,createDataCollectionRequestPayload:tn,createDataCollectionRequest:$t,sendEdgeNetworkRequest:I,applyResponse:k});return(e=>{let{componentCreators:t,lifecycle:n,componentRegistry:r,getImmediatelyAvailableTools:o}=e;return t.forEach((e=>{const{namespace:t}=e,n=o(t);let i;try{i=e(n)}catch(e){throw ve({error:e,message:"["+t+"] An error occurred during component creation."})}r.register(t,i)})),n.onComponentsRegistered({lifecycle:n}).then((()=>r))})({componentCreators:u,lifecycle:l,componentRegistry:s,getImmediatelyAvailableTools(e){const n=i(e);return{config:a,componentRegistry:s,consent:S,eventManager:D,fireReferrerHideableImage:or,logger:n,lifecycle:l,sendEdgeNetworkRequest:I,handleError:Qt({errorPrefix:"["+t+"] ["+e+"]",logger:n}),createNamespacedStorage:Kn,apexDomain:nr,getBrowser:ar}}})},setDebugCommand:e=>{n(e.enabled,{fromConfig:!1})},handleError:g,validateCommandOptions:zt});return m};var cr=e=>{let{eventManager:t,lifecycle:n,handleError:r}=e;const o=(e=>{let{eventManager:t,lifecycle:n,handleError:r}=e;return e=>{if(e.s_fe)return Promise.resolve();const o="composedPath"in e&&e.composedPath().length>0?e.composedPath()[0]:e.target,i=t.createEvent();return i.documentMayUnload(),n.onClick({event:i,clickedElement:o}).then((()=>i.isEmpty()?Promise.resolve():t.sendEvent(i))).then(se).catch((e=>{r(e,"click collection")}))}})({eventManager:t,lifecycle:n,handleError:r});document.addEventListener("click",o,!0)};const dr="\\.(exe|zip|wav|mp3|mov|mpg|avi|wmv|pdf|doc|docx|xls|xlsx|ppt|pptx)$",lr=vt().regexp().default(dr),ur=yt({clickCollectionEnabled:pt().default(!0),clickCollection:yt({internalLinkEnabled:pt().default(!0),externalLinkEnabled:pt().default(!0),downloadLinkEnabled:pt().default(!0),sessionStorageEnabled:pt().default(!1),eventGroupingEnabled:pt().default(!1),filterClickProperties:gt()}).default({internalLinkEnabled:!0,externalLinkEnabled:!0,downloadLinkEnabled:!0,sessionStorageEnabled:!1,eventGroupingEnabled:!1}),downloadLinkQualifier:lr,onBeforeLinkClickSend:gt().deprecated('The field "onBeforeLinkClickSend" has been deprecated. Use "clickCollection.filterClickDetails" instead.')});var pr=function(){return null!==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:document).getElementById("cppXYctnr")},gr=e=>{let t=e;/^https?:\/\//i.test(t)||(t=window.location.protocol+"//"+e);return new URL(t).hostname};var mr=e=>{let{config:t,logger:n,getClickedElementProperties:r,clickActivityStorage:o}=e;const{clickCollectionEnabled:i,clickCollection:a}=t;return i?e=>{let{event:i,clickedElement:s}=e;const c=r({clickActivityStorage:o,clickedElement:s,config:t,logger:n}),d=c.linkType;var l,u;pr()||(c.isValidLink()&&((e,t)=>t&&("download"===t&&!e.downloadLinkEnabled||"exit"===t&&!e.externalLinkEnabled||"other"===t&&!e.internalLinkEnabled))(a,d)?n.info("Cancelling link click event due to clickCollection."+d+"LinkEnabled = false."):c.isInternalLink()&&a.eventGroupingEnabled&&(!t.onBeforeLinkClickSend||a.filterClickDetails)&&(l=window.location.hostname,u=c.linkUrl,gr(l)===gr(u))?o.save(c.properties):c.isValidLink()?(i.mergeXdm(c.xdm),i.mergeData(c.data),o.save({pageName:c.pageName,pageIDType:c.pageIDType})):c.isValidActivityMapData()&&o.save(c.properties))}:()=>{}};var fr=function(){let{properties:e,logger:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e||{};return{get pageName(){return n.pageName},set pageName(e){n.pageName=e},get linkName(){return n.linkName},set linkName(e){n.linkName=e},get linkRegion(){return n.linkRegion},set linkRegion(e){n.linkRegion=e},get linkType(){return n.linkType},set linkType(e){n.linkType=e},get linkUrl(){return n.linkUrl},set linkUrl(e){n.linkUrl=e},get pageIDType(){return n.pageIDType},set pageIDType(e){n.pageIDType=e},get clickedElement(){return n.clickedElement},set clickedElement(e){n.clickedElement=e},get properties(){return{pageName:n.pageName,linkName:n.linkName,linkRegion:n.linkRegion,linkType:n.linkType,linkUrl:n.linkUrl,pageIDType:n.pageIDType}},isValidLink:()=>!!(n.linkUrl&&n.linkType&&n.linkName&&n.linkRegion),isInternalLink(){return this.isValidLink()&&"other"===n.linkType},isValidActivityMapData:()=>!!n.pageName&&!!n.linkName&&!!n.linkRegion&&void 0!==n.pageIDType,get xdm(){return n.filteredXdm?n.filteredXdm:(e=>({eventType:"web.webinteraction.linkClicks",web:{webInteraction:{name:e.linkName,region:e.linkRegion,type:e.linkType,URL:e.linkUrl,linkClicks:{value:1}}}}))(this)},get data(){return n.filteredData?n.filteredData:(e=>({__adobe:{analytics:{contextData:{a:{activitymap:{page:e.pageName,link:e.linkName,region:e.linkRegion,pageIDType:e.pageIDType}}}}}}))(this)},applyPropertyFilter(e){e&&!1===e(n)&&(t&&t.info("Clicked element properties were rejected by filter function: "+JSON.stringify(this.properties,null,2)),n={})},applyOptionsFilter(e){const r=this.options;if(r&&r.clickedElement&&(r.xdm||r.data)){if(e&&!1===e(r))return t&&t.info("Clicked element properties were rejected by filter function: "+JSON.stringify(this.properties,null,2)),void(this.options=void 0);this.options=r,n.filteredXdm=r.xdm,n.filteredData=r.data}},get options(){const e={};if(this.isValidLink()&&(e.xdm=this.xdm),this.isValidActivityMapData()&&(e.data=this.data),this.clickedElement&&(e.clickedElement=this.clickedElement),e.xdm||e.data)return e},set options(e){n={},e&&((e,t)=>{const{xdm:n,data:r,clickedElement:o}=e;if(t.clickedElement=o,n&&n.web&&n.web.webInteraction){const{name:e,region:r,type:o,URL:i}=n.web.webInteraction;t.linkName=e,t.linkRegion=r,t.linkType=o,t.linkUrl=i}if(r&&r.__adobe&&r.__adobe.analytics){const{contextData:e}=r.__adobe.analytics;if(e&&e.a&&e.a.activitymap){const{page:n,link:r,region:o,pageIDType:i}=e.a.activitymap;t.pageName=n||t.pageName,t.linkName=r||t.linkName,t.linkRegion=o||t.linkRegion,void 0!==i&&(t.pageIDType=i)}}})(e,n)}}};const hr="clickData";var yr=e=>e&&e.replace(/\s+/g," ").trim();const vr=/^(SCRIPT|STYLE|LINK|CANVAS|NOSCRIPT|#COMMENT)$/i;const wr=e=>{let t=[],n=!1;if((e=>!(e&&e.nodeName&&e.nodeName.match(vr)))(e)){if(t.push(e),e.childNodes){Array.prototype.slice.call(e.childNodes).forEach((e=>{const r=wr(e);t=t.concat(r.supportedNodes),n=n||r.includesUnsupportedNodes}))}}else n=!0;return{supportedNodes:t,includesUnsupportedNodes:n}},br=(e,t,n)=>{let r;return n&&n!==e.nodeName.toUpperCase()||(r=e.getAttribute(t)),r};const Er=/^(HEADER|MAIN|FOOTER|NAV)$/i,Cr=e=>{let t;return"region"===e.role&&ae(e["aria-label"])&&(t=e["aria-label"]),t},Ir=e=>{let t;return e&&e.nodeName&&e.nodeName.match(Er)&&(t=e.nodeName),t};var kr=e=>!(!e.href||"A"!==e.tagName&&"AREA"!==e.tagName||e.onclick&&e.protocol&&!(e.protocol.toLowerCase().indexOf("javascript")<0)),Sr=e=>!!e&&!!e.onclick,Dr=e=>{if("INPUT"===e.tagName){const t=e.getAttribute("type");if("submit"===t)return!0;if("image"===t&&e.src)return!0}return!1},Pr=e=>"BUTTON"===e.tagName&&"submit"===e.type,Tr=e=>{const t=e.indexOf("?"),n=e.indexOf("#");return t>=0&&(t<n||n<0)?e.substring(0,t):n>=0?e.substring(0,n):e};const Rr=(e=>{let{window:t,getLinkName:n,getLinkRegion:r,getAbsoluteUrlFromAnchorElement:o,findClickableElement:i,determineLinkType:a}=e;return e=>{let{clickedElement:s,config:c,logger:d,clickActivityStorage:l}=e;const{onBeforeLinkClickSend:u,clickCollection:p}=c,{filterClickDetails:g}=p,m=fr({logger:d});if(s){const e=i(s);if(e){m.clickedElement=s,m.linkUrl=o(t,e),m.linkType=a(t,c,m.linkUrl,e),m.linkRegion=r(e),m.linkName=n(e),m.pageIDType=0,m.pageName=t.location.href;const i=l.load();i&&i.pageName&&(m.pageName=i.pageName,m.pageIDType=1),g?m.applyPropertyFilter(g):u&&m.applyOptionsFilter(u)}}return m}})({window:window,getLinkName:e=>{let t=yr(e.innerText||e.textContent);const n=wr(e);if(!t||n.includesUnsupportedNodes){const e=(e=>{const t={texts:[]};return e.supportedNodes.forEach((e=>{e.getAttribute&&(t.alt||(t.alt=yr(e.getAttribute("alt"))),t.title||(t.title=yr(e.getAttribute("title"))),t.inputValue||(t.inputValue=yr(br(e,"value","INPUT"))),t.imgSrc||(t.imgSrc=yr(br(e,"src","IMG")))),e.nodeValue&&t.texts.push(e.nodeValue)})),t})(n);t=yr(e.texts.join("")),t||(t=e.alt||e.title||e.inputValue||e.imgSrc)}return t||""},getLinkRegion:e=>{let t,n=e.parentNode;for(;n;){if(t=yr(n.id||Cr(n)||Ir(n)),t)return t;n=n.parentNode}return"BODY"},getAbsoluteUrlFromAnchorElement:(e,t)=>{const n=e.location;let r=t.href||"";"string"!=typeof r&&(r="");let{protocol:o,host:i}=t;if(r&&(!(a=r)||!/^[a-z0-9]+:\/\//i.test(a))){o||(o=n.protocol?n.protocol:""),o=o?o+"//":"",i||(i=n.host?n.host:"");let e="";if("/"!==r.substring(0,1)){let t=n.pathname.lastIndexOf("/");t=t<0?0:t,e=n.pathname.substring(0,t)}r=""+o+i+e+"/"+r}var a;return r},findClickableElement:e=>{let t=e;for(;t;){if(kr(t)||Sr(t)||Dr(t)||Pr(t))return t;t=t.parentNode}return null},determineLinkType:(e,t,n,r)=>{let o="other";return ae(n)&&(((e,t,n)=>{let r=!1;if(t)if(n&&n.download)r=!0;else if(e){const n=new RegExp(e),o=Tr(t).toLowerCase();r=n.test(o)}return r})(t.downloadLinkQualifier,n,r)?o="download":((e,t)=>{let n=!1;if(t&&e.location.hostname){const r=e.location.hostname.toLowerCase();n=Tr(t).toLowerCase().indexOf(r)<0}return n})(e,n)&&(o="exit")),o}});let Or;const Nr=e=>{if(!Or){const t=te(window)(e.orgId||""),n=(()=>{const e={};return{getItem:t=>e[t],setItem:(t,n)=>{e[t]=n},removeItem:t=>{delete e[t]}}})(),r=e.clickCollection.sessionStorageEnabled?t.session:n;Or=(e=>{let{storage:t}=e;return{save:e=>{const n=JSON.stringify(e);t.setItem(hr,n)},load:()=>{let e=null;const n=t.getItem(hr);return n&&(e=JSON.parse(n)),e},remove:()=>{t.removeItem(hr)}}})({storage:r})}},Ar=e=>{let{config:t,eventManager:n,handleError:r,logger:o}=e;((e,t)=>{const{clickCollectionEnabled:n,onBeforeLinkClickSend:r,downloadLinkQualifier:o}=e;!1===n&&(r&&t.warn("The 'onBeforeLinkClickSend' configuration was provided but will be ignored because clickCollectionEnabled is false."),o&&o!==dr&&t.warn("The 'downloadLinkQualifier' configuration was provided but will be ignored because clickCollectionEnabled is false."))})(t,o);const i=t.clickCollection;Or||Nr(t);const a=mr({config:t,logger:o,clickActivityStorage:Or,getClickedElementProperties:Rr}),s=(e=>{let{clickActivityStorage:t}=e;return e=>{if(pr())return;const n=t.load(),r=fr({properties:n});if(r.isValidLink()||r.isValidActivityMapData()){if(r.isValidLink()){const t=r.xdm;delete t.eventType,e.mergeXdm(t)}r.isValidActivityMapData()&&e.mergeData(r.data),t.save({pageName:r.pageName,pageIDType:r.pageIDType})}}})({clickActivityStorage:Or}),c=(e=>{let{clickActivityStorage:t}=e;return e=>{t.save({pageName:e.getContent().xdm.web.webPageDetails.name,pageIDType:1})}})({clickActivityStorage:Or});return{lifecycle:{onComponentsRegistered(e){const{lifecycle:t}=e;cr({eventManager:n,lifecycle:t,handleError:r})},onClick(e){let{event:t,clickedElement:n}=e;a({event:t,clickedElement:n})},onBeforeEvent(e){let{event:t}=e;(e=>{const t=e.getContent();return void 0!==t.xdm&&void 0!==t.xdm.web&&void 0!==t.xdm.web.webPageDetails&&void 0!==t.xdm.web.webPageDetails.name})(t)&&(i.eventGroupingEnabled&&s(t),c(t,o,Or))}}}};Ar.namespace="ActivityCollector",Ar.configValidators=ur,Ar.buildOnInstanceConfiguredExtraParams=e=>{let{config:t,logger:n}=e;return Or||Nr(t),{getLinkDetails:e=>Rr({clickActivityStorage:Or,clickedElement:e,config:t,logger:n}).properties}};var Mr=e=>{let{fireReferrerHideableImage:t,logger:n,cookieJar:r,isPageSsl:o}=e;const i=o?{sameSite:"none",secure:!0}:{};return e=>((e=>{e.filter((e=>"cookie"===e.type)).forEach((e=>{const{name:t,value:n,domain:o,ttlDays:a}=e.spec;r.set(t,n||"",{domain:o||"",expires:a||10,...i})}))})(e),(e=>{const r=e.filter((e=>"url"===e.type));return Promise.all(r.map((e=>t(e.spec).then((()=>{n.info((e=>"URL destination succeeded: "+e.spec.url)(e))})).catch((()=>{}))))).then(se)})(e))},xr=e=>{let{processDestinations:t}=e;return e=>{let{response:n}=e;return(e=>{let{response:n}=e;const r=n.getPayloadsByType("activation:push");return t(r)})({response:n}).then((()=>(e=>{let{response:t}=e;return{destinations:t.getPayloadsByType("activation:pull")}})({response:n})))}};const qr=e=>{let{logger:t,fireReferrerHideableImage:n}=e;const r=o.withConverter({write:e=>encodeURIComponent(e)}),i=d({logger:t,cookieJar:r}),a=Mr({fireReferrerHideableImage:n,logger:t,cookieJar:i,isPageSsl:"https:"===window.location.protocol});return{lifecycle:{onResponse:xr({processDestinations:a})},commands:{}}};qr.namespace="Audiences";var Lr=e=>U(JSON.stringify(fe(e)));const Ur=e=>{let{standard:t,version:n}=e;return t+"."+n};var jr=()=>{const e={},t=Zt({content:e,addIdentity:(t,n)=>{e.identityMap=e.identityMap||{},e.identityMap[t]=e.identityMap[t]||[],e.identityMap[t].push(n)},hasIdentity:t=>void 0!==(e.identityMap&&e.identityMap[t])});return t.setConsent=t=>{e.consent=t},t},Br=e=>{let{payload:t,datastreamIdOverride:n}=e;return Kt({payload:t,datastreamIdOverride:n,getAction:()=>"privacy/set-consent",getUseSendBeacon:()=>!1})},Fr=e=>e.split(";").reduce(((e,t)=>{const[n,r]=t.split("=");return e[n]=r,e}),{}),_r=yt({consent:ut(lt()).required().nonEmpty(),identityMap:bt,edgeConfigOverrides:Et}).noUnknownFields().required(),Vr=yt({defaultConsent:wt(Tt,Rt,Ot).default(Tt)});const Hr=e=>{let{config:n,consent:r,sendEdgeNetworkRequest:i,createNamespacedStorage:a}=e;const{orgId:s,defaultConsent:c}=n,d=(e=>{let{parseConsentCookie:t,orgId:n,cookieJar:r}=e;const o=V(n,"consent");return{read(){const e=r.get(o);return e?t(e):{}},clear(){r.remove(o)}}})({parseConsentCookie:Fr,orgId:s,cookieJar:o}),l=(()=>{let e=0,t=Promise.resolve();return{addTask(n){e+=1;const r=()=>n().finally((()=>{e-=1}));return t=t.then(r,r),t},get length(){return e}}})(),u=(e=>{let{createConsentRequestPayload:n,createConsentRequest:r,sendEdgeNetworkRequest:o,edgeConfigOverrides:i}=e;return e=>{let{consentOptions:a,identityMap:s,edgeConfigOverrides:c}=e;const d=nn({payload:n(),globalConfigOverrides:i,localConfigOverrides:c});d.payload.setConsent(a),t(s)&&Object.keys(s).forEach((e=>{s[e].forEach((t=>{d.payload.addIdentity(e,t)}))}));const l=r(d);return o({request:l}).then((()=>{}))}})({createConsentRequestPayload:jr,createConsentRequest:Br,sendEdgeNetworkRequest:i,edgeConfigOverrides:n.edgeConfigOverrides}),p=(e=>{let{storage:t}=e;return{clear(){t.clear()},lookup(e){const n={},r=e=>{const t=Ur(e),{standard:r,version:o,...i}=e;return n[t]||(n[t]=Lr(i).toString()),n[t]};return{isNew:()=>e.some((e=>{const n=Ur(e),o=t.getItem(n);return null===o||o!==r(e)})),save(){e.forEach((e=>{const n=Ur(e);t.setItem(n,r(e))}))}}}}})({storage:a(_(s)+".consentHashes.").persistent}),g=Z({orgId:s});return(e=>{let{storedConsent:t,taskQueue:n,defaultConsent:r,consent:o,sendSetConsentRequest:i,validateSetConsentOptions:a,consentHashStore:s,doesIdentityCookieExist:c}=e;const d={[Nt]:r};let l=t.read();const u=c(),p=void 0!==l[Nt];u&&p||s.clear(),u||(t.clear(),l={}),o.initializeConsent(d,l);const g=()=>{if(0===n.length){const e=t.read();void 0!==e[Nt]&&o.setConsent(e)}};return{commands:{setConsent:{optionsValidator:a,run:e=>{let{consent:t,identityMap:r,edgeConfigOverrides:a}=e;o.suspend();const c=s.lookup(t);return n.addTask((()=>c.isNew()?i({consentOptions:t,identityMap:r,edgeConfigOverrides:a}):Promise.resolve())).then((()=>c.save())).finally(g)}}},lifecycle:{onResponse:g,onRequestFailure:g}}})({storedConsent:d,taskQueue:l,defaultConsent:c,consent:r,sendSetConsentRequest:u,validateSetConsentOptions:_r,consentHashStore:p,doesIdentityCookieExist:g})};Hr.namespace="Consent",Hr.configValidators=Vr;var zr=()=>({eventMergeId:Se()});const Jr=()=>(e=>{let{createEventMergeId:t}=e;return{commands:{createEventMergeId:{run:t}}}})({createEventMergeId:zr});Jr.namespace="EventMerge";var Gr={PAUSE:"media.pauseStart",PLAY:"media.play",BUFFER_START:"media.bufferStart",AD_START:"media.adStart",Ad_BREAK_START:"media.adBreakStart",SESSION_END:"media.sessionEnd",SESSION_START:"media.sessionStart",SESSION_COMPLETE:"media.sessionComplete",PING:"media.ping",AD_BREAK_COMPLETE:"media.adBreakComplete",AD_COMPLETE:"media.adComplete",AD_SKIP:"media.adSkip",BITRATE_CHANGE:"media.bitrateChange",CHAPTER_COMPLETE:"media.chapterComplete",CHAPTER_SKIP:"media.chapterSkip",CHAPTER_START:"media.chapterStart",ERROR:"media.error",STATES_UPDATE:"media.statesUpdate"},Qr=e=>{let{config:t,eventManager:n,consent:r,sendEdgeNetworkRequest:o,setTimestamp:i}=e;return{createMediaEvent(e){let{options:r}=e;const o=n.createEvent(),{xdm:a}=r;if(i(a),o.setUserXdm(a),a.eventType===Gr.AD_START){const{advertisingDetails:e}=r.xdm.mediaCollection;o.mergeXdm({mediaCollection:{advertisingDetails:{playerName:e.playerName||t.streamingMedia.playerName}}})}return o},createMediaSession(e){const{playerName:r,channel:o,appVersion:i}=t.streamingMedia,a=n.createEvent(),{sessionDetails:s}=e.xdm.mediaCollection;return a.setUserXdm(e.xdm),a.mergeXdm({eventType:Gr.SESSION_START,mediaCollection:{sessionDetails:{playerName:s.playerName||r,channel:s.channel||o,appVersion:s.appVersion||i}}}),a},augmentMediaEvent(e){let{event:t,playerId:n,getPlayerDetails:r,sessionID:o}=e;if(!n||!r)return t;const{playhead:i,qoeDataDetails:a}=r({playerId:n});return t.mergeXdm({mediaCollection:{playhead:we(i),qoeDataDetails:a,sessionID:o}}),t},trackMediaSession(e){let{event:t,mediaOptions:r,edgeConfigOverrides:o}=e;const i={mediaOptions:r,edgeConfigOverrides:o};return n.sendEvent(t,i)},trackMediaEvent(e){let{event:t,action:n}=e;const i=tn(),a=(e=>{let{mediaRequestPayload:t,action:n}=e;return Kt({payload:t,edgeSubPath:"/va",getAction:()=>n,getUseSendBeacon:()=>!1})})({mediaRequestPayload:i,action:n});return i.addEvent(t),t.finalize(),r.awaitConsent().then((()=>o({request:a}).then((()=>({})))))}}},Xr="main",Wr="completed",Yr=()=>{let e;return{getSession:t=>e[t]||{},storeSession:t=>{let{playerId:n,sessionDetails:r}=t;void 0===e&&(e={}),e[n]=r},stopPing:t=>{let{playerId:n}=t;const r=e[n];r&&(clearTimeout(r.pingId),r.pingId=null,r.playbackState=Wr)},savePing:t=>{let{playerId:n,pingId:r,playbackState:o}=t;e[n]&&(e[n].pingId&&clearTimeout(e[n].pingId),e[n].pingId=r,e[n].playbackState=o)}}};var Kr=e=>{let{mediaEventManager:t,mediaSessionCacheManager:n,config:r}=e;const o=e=>{const i=t.createMediaEvent({options:e}),{playerId:a,xdm:s}=e,{eventType:c}=s,d=c.split(".")[1],{getPlayerDetails:l,sessionPromise:u,playbackState:p}=n.getSession(a);return u.then((e=>e.sessionId?(t.augmentMediaEvent({event:i,eventType:c,playerId:a,getPlayerDetails:l,sessionID:e.sessionId}),t.trackMediaEvent({event:i,action:d}).then((()=>{if(a)if(c===Gr.SESSION_COMPLETE||c===Gr.SESSION_END)n.stopPing({playerId:a});else{const e=((e,t)=>e===Gr.AD_START||e===Gr.Ad_BREAK_START||e===Gr.AD_SKIP||e===Gr.AD_COMPLETE?"ad":e===Gr.AD_BREAK_COMPLETE||e===Gr.CHAPTER_COMPLETE||e===Gr.CHAPTER_START||e===Gr.CHAPTER_SKIP||e===Gr.SESSION_START?"main":e===Gr.SESSION_END||e===Gr.SESSION_COMPLETE?"completed":t)(c,p);if("completed"===e)return;const t="ad"===e?r.streamingMedia.adPingInterval:r.streamingMedia.mainPingInterval,i=setTimeout((()=>{o({playerId:a,xdm:{eventType:Gr.PING}})}),1e3*t);n.savePing({playerId:a,pingId:i,playbackState:e})}}))):Promise.reject(new Error("Failed to trigger media event: "+c+". Session ID is not available for playerId: "+a+"."))))};return e=>o(e)},$r=e=>{let{config:t,mediaEventManager:n,mediaSessionCacheManager:r,legacy:o=!1}=e;return e=>{if(!t.streamingMedia)return Promise.reject(new Error("Streaming media is not configured."));const{playerId:i,getPlayerDetails:a,edgeConfigOverrides:s}=e,c=n.createMediaSession(e);n.augmentMediaEvent({event:c,playerId:i,getPlayerDetails:a});const d=n.trackMediaSession({event:c,mediaOptions:{playerId:i,getPlayerDetails:a,legacy:o},edgeConfigOverrides:s});return r.storeSession({playerId:i,sessionDetails:{sessionPromise:d,getPlayerDetails:a,playbackState:Xr}}),d}},Zr=e=>!ie(e)||!e.trim(),eo=e=>{let{mediaSessionCacheManager:t,config:n,trackMediaEvent:r}=e;return e=>{let{response:o,playerId:i,getPlayerDetails:a}=e;const s=o.getPayloadsByType("media-analytics:new-session");if(w(s)){const{sessionId:e}=s[0];if(Zr(e))return{};if(!i||!a)return{sessionId:e};const o=setTimeout((()=>{r({playerId:i,xdm:{eventType:Gr.PING}})}),1e3*n.streamingMedia.mainPingInterval);return t.savePing({playerId:i,pingId:o,playbackState:Xr}),{sessionId:e}}return{}}};const to={Video:"video",Audio:"audio"},no={VOD:"vod",Live:"live",Linear:"linear",Podcast:"podcast",Audiobook:"audiobook",AOD:"aod"},ro={FullScreen:"fullScreen",ClosedCaption:"closedCaptioning",Mute:"mute",PictureInPicture:"pictureInPicture",InFocus:"inFocus"},oo={AdBreakStart:"adBreakStart",AdBreakComplete:"adBreakComplete",AdStart:"adStart",AdComplete:"adComplete",AdSkip:"adSkip",ChapterStart:"chapterStart",ChapterComplete:"chapterComplete",ChapterSkip:"chapterSkip",SeekStart:"seekStart",SeekComplete:"seekComplete",BufferStart:"bufferStart",BufferComplete:"bufferComplete",BitrateChange:"bitrateChange",StateStart:"stateStart",StateEnd:"stateEnd"},io="sessionStart",ao="sessionEnd",so="sessionComplete",co="play",lo="pauseStart",uo="error",po="statesUpdate",go={MediaResumed:"media.resumed",GranularAdTracking:"media.granularadtracking"},mo={Show:"a.media.show",Season:"a.media.season",Episode:"a.media.episode",AssetId:"a.media.asset",Genre:"a.media.genre",FirstAirDate:"a.media.airDate",FirstDigitalDate:"a.media.digitalDate",Rating:"a.media.rating",Originator:"a.media.originator",Network:"a.media.network",ShowType:"a.media.type",AdLoad:"a.media.adLoad",MVPD:"a.media.pass.mvpd",Authorized:"a.media.pass.auth",DayPart:"a.media.dayPart",Feed:"a.media.feed",StreamFormat:"a.media.format"},fo={Artist:"a.media.artist",Album:"a.media.album",Label:"a.media.label",Author:"a.media.author",Station:"a.media.station",Publisher:"a.media.publisher"},ho={Advertiser:"a.media.ad.advertiser",CampaignId:"a.media.ad.campaign",CreativeId:"a.media.ad.creative",PlacementId:"a.media.ad.placement",SiteId:"a.media.ad.site",CreativeUrl:"a.media.ad.creativeURL"};var yo=e=>{let{logger:t}=e;return{createMediaObject:(e,n,r,o,i)=>{const a={friendlyName:e,name:n,length:r,streamType:i,contentType:o},s=yt({friendlyName:vt().nonEmpty(),name:vt().nonEmpty(),length:ft().required(),streamType:vt().nonEmpty(),contentType:vt().nonEmpty()});try{const e=s(a);return{sessionDetails:{name:e.name,friendlyName:e.friendlyName,length:e.length,streamType:e.streamType,contentType:e.contentType}}}catch(e){return t.warn("An error occurred while creating the Media Object.",e),{}}},createAdBreakObject:(e,n,r)=>{const o={friendlyName:e,offset:n,index:r},i=yt({friendlyName:vt().nonEmpty(),offset:ft(),index:ft()});try{const e=i(o);return{advertisingPodDetails:{friendlyName:e.friendlyName,offset:e.offset,index:e.index}}}catch(e){return t.warn("An error occurred while creating the Ad Break Object.",e),{}}},createAdObject:(e,n,r,o)=>{const i={friendlyName:e,name:n,podPosition:r,length:o},a=yt({friendlyName:vt().nonEmpty(),name:vt().nonEmpty(),podPosition:ft(),length:ft()});try{const e=a(i);return{advertisingDetails:{friendlyName:e.friendlyName,name:e.name,podPosition:e.podPosition,length:e.length}}}catch(e){return t.warn("An error occurred while creating the Advertising Object.",e),{}}},createChapterObject:(e,n,r,o)=>{const i={friendlyName:e,offset:n,length:r,index:o},a=yt({friendlyName:vt().nonEmpty(),offset:ft(),length:ft(),index:ft()});try{const e=a(i);return{chapterDetails:{friendlyName:e.friendlyName,offset:e.offset,index:e.index,length:e.length}}}catch(e){return t.warn("An error occurred while creating the Chapter Object.",e),{}}},createStateObject:e=>{const n=vt().matches(/^[a-zA-Z0-9_]{1,64}$/,"This is not a valid state name.");try{return{name:n(e)}}catch(e){return t.warn("An error occurred while creating the State Object.",e),{}}},createQoEObject:(e,n,r,o)=>{const i={bitrate:e,droppedFrames:n,fps:r,startupTime:o},a=yt({bitrate:ft(),droppedFrames:ft(),fps:ft(),startupTime:ft()});try{const e=a(i);return{bitrate:e.bitrate,droppedFrames:e.droppedFrames,framesPerSecond:e.fps,timeToStart:e.startupTime}}catch(e){return t.warn("An error occurred while creating the QOE Object.",e),{}}}}};const vo={"a.media.show":"show","a.media.season":"season","a.media.episode":"episode","a.media.asset":"assetID","a.media.genre":"genre","a.media.airDate":"firstAirDate","a.media.digitalDate":"firstDigitalDate","a.media.rating":"rating","a.media.originator":"originator","a.media.network":"network","a.media.type":"showType","a.media.adLoad":"adLoad","a.media.pass.mvpd":"mvpd","a.media.pass.auth":"authorized","a.media.dayPart":"dayPart","a.media.feed":"feed","a.media.format":"streamFormat","a.media.artist":"artist","a.media.album":"album","a.media.label":"label","a.media.author":"author","a.media.station":"station","a.media.publisher":"publisher","media.resumed":"hasResume"},wo={"a.media.ad.advertiser":"advertiser","a.media.ad.campaign":"campaignID","a.media.ad.creative":"creativeID","a.media.ad.placement":"placementID","a.media.ad.site":"siteID","a.media.ad.creativeURL":"creativeURL"};var bo=t=>{let{logger:n,trackMediaSession:r,trackMediaEvent:o,uuid:i}=t,a=null;const s=e=>{let{eventType:t,mediaDetails:n={},contextData:r=[]}=e;const o=(e=>{let{eventType:t}=e;return t===oo.BufferComplete||t===oo.SeekComplete?co:t===oo.StateStart||t===oo.StateEnd?po:t===oo.SeekStart?lo:t})({eventType:t});if(t===oo.StateStart){return{eventType:"media."+o,mediaCollection:{statesStart:[n]}}}if(t===oo.StateEnd){return{eventType:"media."+o,mediaCollection:{statesEnd:[n]}}}const i={eventType:"media."+o,mediaCollection:{...n}},a=[];return Object.keys(r).forEach((e=>{vo[e]?i.mediaCollection.sessionDetails[vo[e]]=r[e]:wo[e]?i.mediaCollection.advertisingDetails[wo[e]]=r[e]:a.push({name:e,value:r[e]})})),w(a)&&(i.mediaCollection.customMetadata=a),i};return{trackSessionStart:function(t){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e(t)||q(t))return n.warn("Invalid media object"),{};null===a&&(n.warn("The Media Session was completed. Restarting a new session."),a={qoe:null,lastPlayhead:0,playerId:i()});const c=s({eventType:io,mediaDetails:t,contextData:o});return r({playerId:a.playerId,getPlayerDetails:()=>({playhead:a.lastPlayhead,qoeDataDetails:a.qoe}),xdm:c})},trackPlay:()=>{if(null===a)return n.warn("The Media Session was completed."),{};const e=s({eventType:co});return o({playerId:a.playerId,xdm:e})},trackPause:()=>{if(null===a)return n.warn("The Media Session was completed."),{};const e=s({eventType:lo});return o({playerId:a.playerId,xdm:e})},trackSessionEnd:()=>{if(null===a)return n.warn("The Media Session was completed."),{};const e=s({eventType:ao});return o({playerId:a.playerId,xdm:e})},trackComplete:()=>{if(null===a)return n.warn("The Media Session was completed."),{};const e=s({eventType:so});return o({playerId:a.playerId,xdm:e})},trackError:e=>{if(n.warn("trackError("+e+")"),null===a)return n.warn("The Media Session was completed."),{};const t=s({eventType:uo,mediaDetails:{errorDetails:{name:e,source:"player"}}});return o({playerId:a.playerId,xdm:t})},trackEvent:(e,t,r)=>{if(q(t))return n.warn("Invalid media object."),{};if(null===a)return n.warn("The Media Session was completed."),{};if(!Object.values(oo).includes(e))return n.warn("Invalid event type"),{};const i=s({eventType:e,mediaDetails:t,contextData:r});return o({playerId:a.playerId,xdm:i})},updatePlayhead:e=>{null!==a?re(e)&&(a.lastPlayhead=parseInt(e,10)):n.warn("The Media Session was completed.")},updateQoEObject:e=>{null!==a?e&&(a.qoe=e):n.warn("The Media Session was completed.")},destroy:()=>{n.warn("Destroy called, destroying the tracker."),a=null}}};const Eo=e=>{let{eventManager:t,sendEdgeNetworkRequest:n,config:r,logger:o,consent:i}=e;const a=Yr(),s=Qr({sendEdgeNetworkRequest:n,config:r,consent:i,eventManager:t,setTimestamp:fn((()=>new Date))}),c=Kr({mediaSessionCacheManager:a,mediaEventManager:s,config:r}),d=$r({config:r,mediaEventManager:s,mediaSessionCacheManager:a,legacy:!0});return(e=>{let{trackMediaEvent:t,trackMediaSession:n,mediaResponseHandler:r,logger:o,createMediaHelper:i,createGetInstance:a,config:s}=e;return{lifecycle:{onBeforeEvent(e){let{mediaOptions:t,onResponse:n=se}=e;if(!t)return;const{legacy:o,playerId:i,getPlayerDetails:a}=t;o&&n((e=>{let{response:t}=e;return r({playerId:i,getPlayerDetails:a,response:t})}))}},commands:{getMediaAnalyticsTracker:{run:()=>{if(!s.streamingMedia)return Promise.reject(new Error("Streaming media is not configured."));o.info("Streaming media is configured in legacy mode.");const e=i({logger:o});return Promise.resolve({getInstance:()=>a({logger:o,trackMediaEvent:t,trackMediaSession:n,uuid:Se}),Event:oo,MediaType:to,PlayerState:ro,StreamType:no,MediaObjectKey:go,VideoMetadataKeys:mo,AudioMetadataKeys:fo,AdMetadataKeys:ho,...e})}}}}})({mediaResponseHandler:eo({mediaSessionCacheManager:a,config:r,trackMediaEvent:c}),trackMediaSession:d,trackMediaEvent:c,createMediaHelper:yo,createGetInstance:bo,logger:o,config:r})};Eo.namespace="Legacy Media Analytics";const Co="web",Io="webapp",ko="://",So=/^(\w+):\/\/([^/#]+)(\/[^#]*)?(#.*)?$/,Do=/^(?:.*@)?(?:[a-z\d\u00a1-\uffff.-]+|\[[a-f\d:]+])(?::\d+)?$/,Po=/^\/(?:[/\w\u00a1-\uffff-.~]|%[a-fA-F\d]{2})*$/,To=/^#(?:[/\w\u00a1-\uffff-.~]|%[a-fA-F\d]{2})+$/,Ro=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/",t=e.length;for(;t>0&&-1!=="/".indexOf(e.charAt(t-1));)t-=1;return e.substring(0,t)||"/"},Oo=e=>""+e.surfaceType+ko+e.authority+(e.path||"")+(e.fragment||""),No=e=>{const t=e(),n=t.host.toLowerCase(),r=t.pathname;return Co+ko+n+Ro(r)},Ao=(e,t,n)=>{const r=e=>(n.warn(e),null);if(!ae(e))return r("Invalid surface: "+e);const o=((e,t)=>e.startsWith("#")?No(t)+e:e)(e,t),i=(e=>{const t=e.match(So);return t?{surfaceType:(o=t[1],ae(o)?o.toLowerCase():""),authority:(r=t[2],ae(r)?r.toLowerCase():""),path:(n=t[3],ae(n)?Ro(n):"/"),fragment:t[4]}:null;var n,r,o})(o);return null===i?r("Invalid surface: "+e):[Co,Io].includes(i.surfaceType)?i.authority&&Do.test(i.authority)?i.path&&!Po.test(i.path)?r("Invalid path "+i.path+" in surface: "+e):i.fragment&&!To.test(i.fragment)?r("Invalid fragment "+i.fragment+" in surface: "+e):i:r("Invalid authority "+i.authority+" in surface: "+e):r("Unsupported surface type "+i.surfaceType+" in surface: "+e)},Mo=e=>!!e&&0===e.indexOf(Co+ko)&&-1===e.indexOf("#"),xo="https://ns.adobe.com/personalization/default-content-item",qo="https://ns.adobe.com/personalization/dom-action",Lo="https://ns.adobe.com/personalization/html-content-item",Uo="https://ns.adobe.com/personalization/json-content-item",jo="https://ns.adobe.com/personalization/ruleset-item",Bo="https://ns.adobe.com/personalization/redirect-item",Fo="https://ns.adobe.com/personalization/message/in-app",_o=e=>e.filter(((t,n)=>e.indexOf(t)===n));var Vo=t=>{let{getPageLocation:n,renderDecisions:r,decisionScopes:o,personalization:i,event:a,isCacheInitialized:s,logger:c}=t;const d=a.getViewName();return{isRenderDecisions:()=>r,isSendDisplayEvent:()=>!!i.sendDisplayEvent,shouldIncludeRenderedPropositions:()=>!!i.includeRenderedPropositions,getViewName:()=>d,hasScopes:()=>o.length>0||w(i.decisionScopes),hasSurfaces:()=>w(i.surfaces),hasViewName:()=>ae(d),createQueryDetails(){const t=[...o];w(i.decisionScopes)&&t.push(...i.decisionScopes);const r=function(){let t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).map((e=>Ao(e,t,n))).filter((t=>!e(t))).map(Oo)}(i.surfaces,n,c);this.shouldRequestDefaultPersonalization()&&((e=>{e.includes(Wt)||e.push(Wt)})(t),((e,t)=>{const n=No(t);e.includes(n)||e.push(n)})(r,n));const a=[xo,Lo,Uo,Bo,jo,Fo,"https://ns.adobe.com/personalization/message/content-card"];return t.includes(Wt)&&a.push(qo),{schemas:a,decisionScopes:_o(t),surfaces:_o(r)}},isCacheInitialized:()=>s,shouldFetchData(){return this.hasScopes()||this.hasSurfaces()||this.shouldRequestDefaultPersonalization()},shouldUseCachedData(){return this.hasViewName()&&!this.shouldFetchData()},shouldRequestDefaultPersonalization(){return i.defaultPersonalizationEnabled||!this.isCacheInitialized()&&!1!==i.defaultPersonalizationEnabled}}};const Ho="decisioning.propositionDisplay",zo="decisioning.propositionInteract",Jo="decisioning.propositionTrigger",Go="decisioning.propositionDismiss",Qo="decisioning.propositionSuppressDisplay",Xo={DISPLAY:"display",INTERACT:"interact",TRIGGER:"trigger",DISMISS:"dismiss",SUPPRESS:"suppressDisplay"},Wo={[Ho]:Xo.DISPLAY,[zo]:Xo.INTERACT,[Jo]:Xo.TRIGGER,[Go]:Xo.DISMISS,[Qo]:Xo.SUPPRESS},Yo={[Xo.DISPLAY]:Ho,[Xo.INTERACT]:zo,[Xo.TRIGGER]:Jo,[Xo.DISMISS]:Go,[Xo.SUPPRESS]:Qo},Ko=e=>Wo[e],$o=e=>Yo[e],Zo={propositions:[]};var ei=e=>{let{getPageLocation:t,logger:n,fetchDataHandler:r,viewChangeHandler:o,onClickHandler:i,isAuthoringModeEnabled:a,mergeQuery:s,viewCache:c,showContainers:d,applyPropositions:l,setTargetMigration:u,mergeDecisionsMeta:p,renderedPropositions:g,onDecisionHandler:m,handleConsentFlicker:f}=e;return{lifecycle:{onComponentsRegistered(){f()},onDecision:m,onBeforeRequest(e){let{request:t}=e;return u(t),Promise.resolve()},onBeforeEvent(e){let{event:i,renderDecisions:l,decisionScopes:u=[],personalization:m={},onResponse:f=se,onRequestFailure:h=se}=e;if(f((()=>({propositions:[]}))),h((()=>d())),a())return n.warn("Rendering is disabled for authoring mode."),s(i,{enabled:!1}),Promise.resolve();const y=Vo({getPageLocation:t,renderDecisions:l,decisionScopes:u,personalization:m,event:i,isCacheInitialized:c.isInitialized(),logger:n}),v=[];if(y.shouldIncludeRenderedPropositions()&&v.push(g.clear()),y.shouldFetchData()){const e=c.createCacheUpdate(y.getViewName());h((()=>e.cancel())),r({cacheUpdate:e,personalizationDetails:y,event:i,onResponse:f})}else y.shouldUseCachedData()&&v.push(o({personalizationDetails:y,event:i,onResponse:f,onRequestFailure:h}));return Promise.all(v).then((e=>{const t=e.flatMap((e=>e));w(t)&&p(i,t,[Xo.DISPLAY])}))},onClick(e){let{event:t,clickedElement:n}=e;i({event:t,clickedElement:n})}},commands:{applyPropositions:{optionsValidator:e=>(e=>{let{logger:t,options:n}=e;const r=yt({propositions:ut(yt({id:vt().required(),scope:vt().required(),scopeDetails:yt({decisionProvider:vt().required()}).required(),items:ut(yt({id:vt().required(),schema:vt().required(),data:yt(lt())})).nonEmpty().required()}).required()).nonEmpty().required(),metadata:yt(lt()),viewName:vt()}).required();try{return r(n)}catch(e){return t.warn("Invalid options for applyPropositions. No propositions will be applied.",e),Zo}})({logger:n,options:e}),run:l}}}},ti=function(){return g("DIV",{},{innerHTML:arguments.length>0&&void 0!==arguments[0]?arguments[0]:"undefined"})};const ni=/:eq\((\d+)\)/g,ri=e=>-1===e.indexOf(":eq("),oi=/(#|\.)(-?\w+)/g,ii=(e,t,n)=>""+t+CSS.escape(n),ai=e=>{const t=[],n=(e=>e.split(ni).filter(ae))((e=>e.replace(oi,ii))(e.trim())),{length:r}=n;let o=0;for(;o<r;){const e=n[o],r=n[o+1];r?t.push({sel:e,eq:Number(r)}):t.push({sel:e}),o+=2}return t},si=e=>{const t=document;if(ri(e))return D(e,t);const n=ai(e),{length:r}=n;let o=[],i=t,a=0;for(;a<r;){const{sel:e,eq:t}=n[a],s=D(e,i),{length:c}=s;if(0===c)break;if(null!=t&&t>c-1)break;a<r-1&&(null==t?[i]=s:i=s[t]),a===r-1&&(o=null==t?s:[s[t]]),a+=1}return o};var ci=function(e){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:document).getElementById(e)},di=(e,t,n)=>{e.setAttribute(t,n)},li=(e,t)=>e.getAttribute(t),ui=(e,t,n,r)=>{let o;o=r?t+":"+n+" !"+r+";":t+":"+n+";",e.style.cssText+=";"+o},pi=e=>e.parentNode,gi=(e,t)=>{if(!e)return;const n=pi(e);n&&n.insertBefore(t,(e=>e.nextElementSibling)(e))},mi=(e,t)=>{if(!e)return;const n=pi(e);n&&n.insertBefore(t,e)},fi=e=>{const{childNodes:t}=e;return t?b(t):[]},hi=e=>e.firstElementChild;let yi;var vi=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document;if(void 0===yi){const t=e.querySelector("[nonce]");yi=t&&(t.nonce||t.getAttribute("nonce"))}return yi};const wi="src",bi=e=>g(m,{src:e}),Ei=e=>{D(m,e).forEach((e=>{const t=li(e,wi);t&&bi(t)}))},Ci=e=>((e,t)=>e.tagName===t)(e,f)&&!li(e,wi);var Ii=e=>{const t=D(f,e),{length:n}=t,r=vi();if(r)for(let e=0;e<n;e+=1){const n=t[e];Ci(n)&&(n.nonce=r)}};const ki=e=>{const t=document.createElement("script");t.src=e,t.async=!0;const n=((e,t)=>new Promise(((n,r)=>{t.onload=()=>{n(t)},t.onerror=()=>{r(new Error("Failed to load script: "+e))}})))(e,t);return document.head.appendChild(t),n},Si=(e,t)=>!!e&&e.tagName===t,Di=e=>Si(e,h)&&!li(e,wi),Pi=e=>Si(e,h)&&li(e,wi),Ti=e=>{const t=D(h,e),n=[],{length:r}=t,o=vi(),i={...o&&{nonce:o}};for(let e=0;e<r;e+=1){const r=t[e];if(!Di(r))continue;const{textContent:o}=r;o&&n.push(g(h,i,{textContent:o}))}return n},Ri=e=>{const t=D(h,e),n=[],{length:r}=t;for(let e=0;e<r;e+=1){const r=t[e];if(!Pi(r))continue;const o=li(r,wi);o&&n.push(o)}return n},Oi=(e,t)=>{t.forEach((t=>{e.appendChild(t),e.removeChild(t)}))},Ni=e=>Promise.all(e.map(ki));var Ai=(e,t,n)=>{const r=ti(t);Ii(r);const o=fi(r),i=Ti(r),a=Ri(r);return Ei(r),o.forEach((t=>{p(e,t)})),n(e),Oi(e,i),Ni(a)};var Mi=(e,t,n)=>((e=>{fi(e).forEach(A)})(e),Ai(e,t,n)),xi=(e,t,n)=>{const r=ti(t);Ii(r);const o=fi(r),i=Ti(r),a=Ri(r),{length:s}=o;let c=s-1;for(Ei(r);c>=0;){const t=o[c];n(t);const r=hi(e);r?mi(r,t):p(e,t),c-=1}return Oi(e,i),Ni(a)};const qi="alloy-prehiding",Li={},Ui=e=>{if(Li[e])return;const t=vi(),n={...t&&{nonce:t}},r=g(f,n,{textContent:e+" { visibility: hidden }"});p(document.head,r),Li[e]=r},ji=e=>{const t=Li[e];t&&(A(t),delete Li[e])};var Bi=(e,t,n)=>{n(e),e.textContent=t},Fi=(e,t,n)=>{const r=ti(t);Ii(r);const o=fi(r),i=Ti(r),a=Ri(r);return Ei(r),o.forEach((t=>{n(t),mi(e,t)})),Oi(e,i),Ni(a)},_i=(e,t,n)=>Fi(e,t,n).then((()=>{A(e)})),Vi=(e,t,n)=>{const r=ti(t);Ii(r);const o=fi(r),i=Ti(r),a=Ri(r);Ei(r);let s=e;return o.forEach((e=>{n(e),gi(s,e),s=e})),Oi(e,i),Ni(a)},Hi=(e,t,n)=>{const{priority:r,...o}=t;Object.keys(o).forEach((t=>{ui(e,t,o[t],r)})),n(e)},zi=(e,t,n)=>{Object.keys(t).forEach((n=>{di(e,n,t[n])})),n(e)},Ji=(e,t,n)=>{e.tagName===m&&(bi(t),n(e),((e,t)=>{e.removeAttribute(t)})(e,wi),di(e,wi,t))},Gi=(e,t,n)=>{let{from:r,to:o}=t;const i=(e=>{const{children:t}=e;return t?b(t):[]})(e),a=i[r],s=i[o];a&&s&&(r<o?gi(s,a):mi(s,a),n(s),n(a))};const Qi=e=>async(t,n,r)=>{const{selector:o,prehidingSelector:i,content:a}=t;Ui(i);try{(e=>{let{containers:t,content:n,decorateProposition:r,renderFunc:o,renderStatusHandler:i}=e;const a=t.filter(i.shouldRender).map((async e=>{await o(e,n,r),i.markAsRendered(e)}));Promise.all(a)})({containers:await N(o,si),content:a,decorateProposition:n,renderFunc:e,renderStatusHandler:r})}finally{ji(i)}},Xi=e=>(""+e).endsWith("px")?e:e+"px";var Wi=(e,t,n)=>{const{priority:r,...o}=t;Object.keys(o).forEach((t=>{let n=o[t];"left"!==t&&"top"!==t||(n=Xi(n)),ui(e,t,n,r)})),n(e)},Yi=(e,t,n)=>{n(e)},Ki=(e,t,n)=>{const{priority:r,...o}=t;Object.keys(o).forEach((t=>{let n=o[t];"width"!==t&&"height"!==t||(n=Xi(n)),ui(e,t,n,r)})),n(e)};const $i="setHtml",Zi="customCode",ea="setText",ta="setAttribute",na="setImageSource",ra="setStyle",oa="move",ia="resize",aa="rearrange",sa="remove",ca="insertAfter",da="insertBefore",la="replaceHtml",ua="prependHtml",pa="appendHtml",ga="click",ma="collectInteractions";var fa=e=>{let{eventManager:t,mergeDecisionsMeta:n}=e;return e=>{let{decisionsMeta:r=[],propositionAction:o,documentMayUnload:i=!1,eventType:a=Ho,propositionEventTypes:s=[Ko(a)],viewName:c}=e;const d=t.createEvent(),l={eventType:a};return c&&(l.web={webPageDetails:{viewName:c}}),w(r)&&n(d,r,s,o),d.mergeXdm(l),i&&d.documentMayUnload(),t.sendEvent(d)}};var ha=(e,t)=>{if(ri(e))return((e,t)=>t.matches?t.matches(e):t.msMatchesSelector(e))(e,t);const n=si(e);let r=!1;for(let e=0;e<n.length;e+=1)if(n[e]===t){r=!0;break}return r};const ya="view",va=e=>e.map((e=>{const{trackingLabel:t,scopeType:n,...r}=e;return r})),wa=(e,t,n)=>{const{documentElement:r}=document;let o=e,i=0;for(;o&&o!==r;){if(ha(t,o)){const e=n(t),r={metas:e},o=e.find((e=>e.trackingLabel));o&&(r.label=o.trackingLabel,r.weight=i);const a=e.find((e=>e.scopeType===ya));return a&&(r.viewName=a.scope,r.weight=i),r}o=o.parentNode,i+=1}return{metas:null}};var ba=(e,t,n)=>{const r=[];let o,i="",a=Number.MAX_SAFE_INTEGER,s=Number.MAX_SAFE_INTEGER;for(let c=0;c<t.length;c+=1){const{metas:d,label:l,weight:u,viewName:p}=wa(e,t[c],n);d&&(l&&u<=a&&(i=l,a=u),p&&u<=s&&(o=p,s=u),r.push(...va(d)))}return{decisionsMeta:(c=r,c.filter(((e,t)=>{const n=JSON.stringify(e);return t===c.findIndex((e=>JSON.stringify(e)===n))}))),propositionActionLabel:i,propositionActionToken:void 0,viewName:o};var c},Ea=function(){return-1!==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:document).location.href.indexOf("adobe_authoring_enabled")};const Ca=(e,t,n,r)=>{if(0===t.length)return;const o={};n.forEach((e=>{o[e]=1}));const i={_experience:{decisioning:{propositions:t,propositionEventType:o}}};r&&(i._experience.decisioning.propositionAction=r),e.mergeXdm(i)},Ia=(e,t)=>{e.mergeQuery({personalization:{...t}})};var ka=()=>{const e={};return{storeClickMeta:t=>{let{selector:n,meta:{id:r,scope:o,scopeDetails:i,trackingLabel:a,scopeType:s}}=t;e[n]||(e[n]={}),e[n][r]={scope:o,scopeDetails:i,trackingLabel:a,scopeType:s}},getClickSelectors:()=>Object.keys(e),getClickMetas:t=>e[t]?(e=>Object.keys(e).map((t=>({id:t,...e[t]}))))(e[t]):{}}};const Sa=(e,t)=>e===Uo&&t===ma,Da={[qo]:()=>!0,[Lo]:()=>!0,[Uo]:Sa,[Fo]:()=>!0,[xo]:()=>!0};var Pa=e=>{let{processPropositions:t,createProposition:n,renderedPropositions:r,viewCache:o}=e;const i=e=>{let{items:t,metadataForScope:n={}}=e;const{actionType:r,selector:o}=n;return t.filter((e=>((e,t)=>"function"==typeof Da[e]&&Da[e](e,t))(e.schema,r))).map((e=>{const{schema:t}=e;return t===Lo||Sa(t,r)?q(n)?void 0:{...e,schema:Sa(t,r)?qo:t,data:{...e.data,selector:o,type:r}}:{...e}})).filter((e=>e))},a=e=>!(e.scope===Wt&&e.renderAttempted);return e=>{let{propositions:s=[],metadata:c={},viewName:d}=e;const u=l();r.concat(u.promise);const p=(e=>{let{propositions:t,metadata:n}=e;return t.filter(a).map((e=>{if(w(e.items)){const{id:t,scope:r,scopeDetails:o}=e;return{id:t,scope:r,scopeDetails:o,items:i({items:e.items,metadataForScope:n[e.scope]})}}return e})).filter((e=>w(e.items)))})({propositions:s,metadata:c}).map((e=>n(e)));return Promise.resolve().then((()=>d?o.getView(d):[])).then((e=>{const{render:n,returnedPropositions:r}=t([...p,...e]);return n().then(u.resolve),{propositions:r}}))}};var Ta=e=>{const{selector:t,type:n}=e;return n!==Zi||"BODY > *:eq(0)"!==t?e:{...e,selector:"BODY"}};var Ra=e=>{const t={...e},{content:n,selector:r}=t;if(Zr(n))return t;if(null==r)return t;const o=si(r);return Si(o[0],"HEAD")?(t.type=pa,t.content=(e=>{const t=ti(e);return D("SCRIPT,LINK,STYLE",t).map((e=>e.outerHTML)).join("")})(n),t):t},Oa=e=>{let{preprocess:t,isPageWideSurface:n}=e;return function(e){let r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{id:i,scope:a,scopeDetails:s,items:c=[]}=e,{characteristics:{scopeType:d}={}}=s||{};return{getScope:()=>a,getScopeType:()=>a===Wt||n(a)?"page":d===ya?ya:"proposition",getItems(){return c.map((e=>((e,n)=>{const{id:r,schema:o,data:i,characteristics:{trackingLabel:a}={}}=e,s=i?i.type:void 0,c=t(i);return{getId:()=>r,getSchema:()=>o,getSchemaType:()=>s,getData:()=>c,getProposition:()=>n,getTrackingLabel:()=>a,getOriginalItem:()=>e,toString:()=>JSON.stringify(e),toJSON:()=>e}})(e,this)))},getNotification:()=>({id:i,scope:a,scopeDetails:s}),getId:()=>i,toJSON:()=>e,shouldSuppressDisplay:()=>o,addToReturnValues(t,n,o,i){r&&(t.push({...e,items:o.map((e=>e.getOriginalItem())),renderAttempted:i}),i||n.push({...e,items:o.map((e=>e.getOriginalItem()))}))}}}},Na=()=>({render:se,setRenderAttempted:!0,includeInNotification:!0});const Aa="always",Ma="never",xa="decoratedElementsOnly",qa=[Aa,Ma,xa],La="data-aep-interact-id",Ua="data-aep-click-label";let ja=0;const Ba=(e,t,n,r,o,i,a,s)=>{const{scopeDetails:c={}}=a,{decisionProvider:d}=c;return((e,t)=>!!e&&!!e[t]&&[Aa,xa].includes(e[t]))(e,d)||t===ga?e=>{if(!e.tagName)return;const t=(c=li(e,La))?parseInt(c,10):++ja;var c;s(n,r,i,a,t),di(e,La,t),o&&!li(e,Ua)&&di(e,Ua,o)}:se};var Fa=e=>{let{modules:t,logger:n,storeInteractionMeta:r,storeClickMeta:o,autoCollectPropositionInteractions:i}=e;return e=>{const{type:a,selector:s}=e.getData()||{};if(!a)return n.warn("Invalid DOM action data: missing type.",e.getData()),{setRenderAttempted:!1,includeInNotification:!1};if(a===ga)return s?(o({selector:s,meta:{...e.getProposition().getNotification(),trackingLabel:e.getTrackingLabel(),scopeType:e.getProposition().getScopeType()}}),{setRenderAttempted:!0,includeInNotification:!1}):(n.warn("Invalid DOM action data: missing selector.",e.getData()),{setRenderAttempted:!1,includeInNotification:!1});if(!t[a])return n.warn("Invalid DOM action data: unknown type.",e.getData()),{setRenderAttempted:!1,includeInNotification:!1};const c=(d=e.getProposition().getScopeType(),l=e.getId(),d!==ya?{shouldRender:()=>!0,markAsRendered:()=>{}}:{shouldRender:e=>!e||!(e.dataset.adobePropositionIds??"").split(",").includes(l),markAsRendered:e=>{const t=(e.dataset.adobePropositionIds??"").split(",");t.includes(l)||t.push(l),e.dataset.adobePropositionIds=t.sort().join(",")}});var d,l;const u=Ba(i,a,e.getProposition().getId(),e.getId(),e.getTrackingLabel(),e.getProposition().getScopeType(),e.getProposition().getNotification(),r);return{render:()=>t[a](e.getData(),u,c),setRenderAttempted:!0,includeInNotification:!0}}},_a=e=>{let{modules:t,logger:n,storeInteractionMeta:r,autoCollectPropositionInteractions:o}=e;return e=>{const{type:i,selector:a}=e.getData()||{};if(!a||!i)return{setRenderAttempted:!1,includeInNotification:!1};if(!t[i])return n.warn("Invalid HTML content data",e.getData()),{setRenderAttempted:!1,includeInNotification:!1};const s=Ba(o,i,e.getProposition().getId(),e.getId(),e.getTrackingLabel(),e.getProposition().getScopeType(),e.getProposition().getNotification(),r);return{render:()=>t[i](e.getData(),s),setRenderAttempted:!0,includeInNotification:!0}}};const Va="BODY";var Ha=e=>{let{logger:t,executeRedirect:n,collect:r}=e;return e=>{const{content:o}=e.getData()||{};if(!o)return t.warn("Invalid Redirect data",e.getData()),{};return{render:()=>(Ui(Va),r({decisionsMeta:[e.getProposition().getNotification()],documentMayUnload:!0}).then((()=>(t.logOnContentRendering({status:"rendering-redirect",detail:{propositionDetails:e.getProposition().getNotification(),redirect:o},message:"Redirect action "+e.toString()+" executed.",logLevel:"info"}),n(o)))).catch((e=>{throw ji(Va),e}))),setRenderAttempted:!0,onlyRenderThis:!0}}},za=e=>{let{schemaProcessors:t,logger:n}=e;const r=(e,t)=>()=>Promise.resolve().then(e).then((()=>(n.enabled&&n.info("Action "+t.toString()+" executed."),t.toJSON()))).catch((e=>{const{message:r,stack:o}=e,i="Failed to execute action "+t.toString()+". "+r+" "+o;n.logOnContentRendering({status:"rendering-failed",detail:{propositionDetails:t.getProposition().getNotification(),item:t.toJSON()},error:e,message:i,logLevel:"warn"})})),o=e=>{const n=t[e.getSchema()];return n?n(e):{}},i=e=>{let t,n,i,a,{renderers:s,returnedPropositions:c,returnedDecisions:d,items:l,proposition:u}=e,p=[...s],g=[...c],m=[...d],f=[],h=[],y=[],v=!1,b=!1,E=0;for(;l.length>E;){if(a=l[E],({render:t,setRenderAttempted:n,includeInNotification:i,onlyRenderThis:b}=o(a)),b){g=[],m=[],n?(f=[a],h=[]):(f=[],h=[a]),p=[],y=[t],v=i;break}t&&y.push(r(t,a)),i&&(v=!0),n?f.push(a):h.push(a),E+=1}if(y.length>0){const e=v?u.getNotification():void 0;p.push((()=>(async(e,t)=>{const n=(await Promise.allSettled(e.map((e=>e())))).filter((e=>"fulfilled"===e.status)).map((e=>e.value));if(t&&w(n))return{...t,items:n}})(y,e)))}else v&&p.push((()=>Promise.resolve(u.getNotification())));return f.length>0&&u.addToReturnValues(g,m,f,!0),h.length>0&&u.addToReturnValues(g,m,h,!1),{renderers:p,returnedPropositions:g,returnedDecisions:m,onlyRenderThis:b}};return function(e){let t,r,o,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],s=[],c=[],d=[],l=0;for(;e.length>l&&(r=e[l],o=r.getItems(),({renderers:s,returnedPropositions:c,returnedDecisions:d,onlyRenderThis:t}=i({renderers:s,returnedPropositions:c,returnedDecisions:d,items:o,proposition:r})),!t);)l+=1;t&&e.forEach(((e,t)=>{t!==l&&e.addToReturnValues(c,d,e.getItems(),!1)})),a.forEach((e=>{e.addToReturnValues(c,d,e.getItems(),!1)}));return{returnedPropositions:c,returnedDecisions:d,render:()=>Promise.all(s.map((e=>e()))).then((e=>{const t=e.filter((e=>e)),r=t.map((e=>{const{id:t,scope:n,scopeDetails:r}=e;return{id:t,scope:n,scopeDetails:r}}));if(w(t)){const e=H(t,(e=>e.scope));n.logOnContentRendering({status:"rendering-succeeded",detail:{...e},message:"Scopes: "+JSON.stringify(e)+" successfully executed.",logLevel:"info"})}return r}))}}};var Ja=e=>{let{processPropositions:t,createProposition:n,notificationHandler:r}=e;return e=>{let{renderDecisions:o,propositions:i,event:a,personalization:s={}}=e;if(!o)return Promise.resolve();const{sendDisplayEvent:c=!0}=s,d=a?a.getViewName():void 0,l=(()=>{let e=0;return t=>{const{items:n=[]}=t;return!!n.some((e=>e.schema===Fo))&&(e+=1,e>1)}})(),u=i.map((e=>n(e,!0,l(e)))),{render:p,returnedPropositions:g}=t(u),m=r(o,c,d),f=u.reduce(((e,t)=>(e[t.getId()]=t,e)),{});return p().then((e=>{const t=e.filter((e=>!f[e.id].shouldSuppressDisplay())),n=e.filter((e=>f[e.id].shouldSuppressDisplay()));m(t,n)})),Promise.resolve({propositions:g})}};const Ga="text/html",Qa="defaultContent",Xa=["content","contentType"],Wa=["mobileParameters","webParameters","html"];var Ya=e=>{let{modules:t,logger:n}=e;return e=>{const r=e.getData(),o=e.getProposition(),i={...o.getNotification()},a=o.shouldSuppressDisplay();if(!r)return n.warn("Invalid in-app message data: undefined.",r),{};const{type:s=Qa}=r;return t[s]?((e,t)=>{for(let n=0;n<Xa.length;n+=1){const r=Xa[n];if(!Object.prototype.hasOwnProperty.call(e,r))return t.warn("Invalid in-app message data: missing property '"+r+"'.",e),!1}const{content:n,contentType:r}=e;if("application/json"===r)for(let r=0;r<Wa.length;r+=1){const o=Wa[r];if(!Object.prototype.hasOwnProperty.call(n,o))return t.warn("Invalid in-app message data.content: missing property '"+o+"'.",e),!1}return!0})(r,n)?i?{render:()=>a?null:t[s]({...r,meta:i}),setRenderAttempted:!0,includeInNotification:!0}:(n.warn("Invalid in-app message meta: undefined.",i),{}):{}:(n.warn("Invalid in-app message data: unknown type.",r),{})}};const Ka=e=>{const t=D("#"+e,document);t&&t.length>0&&A(t[0])};var $a=e=>function(t){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?e.location.href=t:e.location.replace(t),new Promise((()=>{}))};const Za="alloy-messaging-container",es="alloy-overlay-container",ts="alloy-content-iframe",ns=()=>[Za,es].forEach(Ka),rs=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:$a(window);return n=>{n.preventDefault(),n.stopImmediatePropagation();const{target:r}=n,o="a"===r.tagName.toLowerCase()?r:r.closest("a");if(!o)return;const{action:i,interaction:a,link:s,label:c,uuid:d}=(e=>{const t={};if(!e||"a"!==e.tagName.toLowerCase())return t;const{href:n}=e;if(!n||!n.startsWith("adbinapp://"))return t;const r=n.split("?"),o=r[0].split("://")[1],i=e.innerText,a=e.getAttribute("data-uuid")||"";let s,c;if(w(r)){const e=me.parse(r[1]);s=e.interaction||"",c=Un(e.link||"")}return{action:o,interaction:s,link:c,label:i,uuid:a}})(o);e(i,{label:c,id:a,uuid:d,link:s}),"dismiss"===i&&ns(),ae(s)&&s.length>0&&t(s,!0)}},os=e=>{const{verticalAlign:t,width:n,horizontalAlign:r,backdropColor:o,height:i,cornerRadius:a,horizontalInset:s,verticalInset:c,uiTakeover:d=!1}=e,l={width:n?n+"%":"100%",backgroundColor:o||"rgba(0, 0, 0, 0.5)",borderRadius:a?a+"px":"0px",border:"none",position:d?"fixed":"relative",overflow:"hidden"};return"left"===r?l.left=s?s+"%":"0":"right"===r?l.right=s?s+"%":"0":"center"===r&&(l.left="50%",l.transform="translateX(-50%)"),"top"===t?l.top=c?c+"%":"0":"bottom"===t?(l.position="fixed",l.bottom=c?c+"%":"0"):"center"===t&&(l.top="50%",l.transform=("center"===r?l.transform+" ":"")+"translateY(-50%)",l.display="flex",l.alignItems="center",l.justifyContent="center"),l.height=i?i+"vh":"100%",l},is=e=>{const{backdropOpacity:t,backdropColor:n}=e;return{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",background:"transparent",opacity:t||.5,backgroundColor:n||"#FFFFFF"}},as=["enabled","parentElement","insertionMethod"],ss=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;ns();const{content:n,contentType:r,mobileParameters:o}=e;let{webParameters:i}=e;if(r!==Ga)return;const a=g("div",{id:Za}),s=((e,t)=>{const n=(new DOMParser).parseFromString(e,Ga),r=n.querySelector("script");r&&r.setAttribute("nonce",vi());const o=g("iframe",{src:URL.createObjectURL(new Blob([n.documentElement.outerHTML],{type:"text/html"})),id:ts});return o.addEventListener("load",(()=>{const{addEventListener:e}=o.contentDocument||o.contentWindow.document;e("click",t)})),o})(n,rs(t)),c=g("div",{id:es});(e=>{if(!e)return!1;const t=Object.keys(e);if(!t.includes(Za))return!1;if(!t.includes(es))return!1;const n=Object.values(e);for(let e=0;e<n.length;e+=1){if(!yt(n[e],"style"))return!1;if(!yt(n[e],"params"))return!1;for(let t=0;t<as.length;t+=1)if(!yt(n[e].params,as[t]))return!1}return!0})(i)||(i=(e=>{if(!e)return;const{uiTakeover:t=!1}=e;return{[ts]:{style:{border:"none",width:"100%",height:"100%"},params:{enabled:!0,parentElement:"#alloy-messaging-container",insertionMethod:"appendChild"}},[Za]:{style:os(e),params:{enabled:!0,parentElement:"body",insertionMethod:"appendChild"}},[es]:{style:is(e),params:{enabled:!0===t,parentElement:"body",insertionMethod:"appendChild"}}}})(o)),i&&((e,t,n,r)=>{[{id:es,element:r},{id:Za,element:n},{id:ts,element:e}].forEach((e=>{let{id:n,element:r}=e;const{style:o={},params:i={}}=t[n];Object.assign(r.style,o);const{parentElement:a="body",insertionMethod:s="appendChild",enabled:c=!0}=i,d=document.querySelector(a);c&&d&&"function"==typeof d[s]&&d[s](r)}))})(s,i,a,c)};var cs=e=>({defaultContent:t=>((e,t)=>new Promise((n=>{const{meta:r}=e;ss(e,((e,n)=>{const o={};o[Xo.INTERACT]=1,-1!==Object.values(Xo).indexOf(e)&&(o[e]=1),t({decisionsMeta:[r],propositionAction:n,eventType:zo,propositionEventTypes:Object.keys(o)})})),n({meta:r})})))(t,e)});const ds=e=>{const t=e.find((e=>e.scopeType===ya));return t?t.scope:void 0};var ls=(e,t,n)=>{const{interactIds:r,clickLabel:o="",clickToken:i}=(e=>{const{documentElement:t}=document;let n=e;const r=new Set;let o,i;for(;n&&n!==t&&!(n instanceof ShadowRoot);){const e=li(n,La);e&&r.add(e),o=o||li(n,Ua),i=i||li(n,"data-aep-click-token"),n=n.parentNode}return{interactIds:[...r],clickLabel:o,clickToken:i}})(e),a=((e,t,n)=>r=>{const{scopeDetails:o={}}=r,{decisionProvider:i}=o;return e[i]===Aa||e[i]===xa&&(t||n)})(n,o,i);if(0===r.length)return{};const s=t(r).filter(a);return{decisionsMeta:va(s),propositionActionLabel:o,propositionActionToken:i,viewName:ds(s)}};const us="AJO",ps="TGT",gs=e=>{let{config:t,logger:n,eventManager:r,consent:o}=e;const{targetMigrationEnabled:i,prehidingStyle:a,autoCollectPropositionInteractions:s}=t,c=fa({eventManager:r,mergeDecisionsMeta:Ca}),d=(e=>()=>{const t=ci(qi);t&&(e.logOnContentHiding({status:"show-containers",message:"Prehiding style removed to show containers.",logLevel:"info"}),A(t))})(n),u=(e=>t=>{if(!t)return;if(ci(qi))return;const n=vi(),r={id:qi,...n&&{nonce:n}},o=g(f,r,{textContent:t});e.logOnContentHiding({status:"hide-containers",message:"Prehiding style applied to hide containers.",logLevel:"info"}),p(document.head,o)})(n),{storeInteractionMeta:m,getInteractionMetas:h}=(()=>{const e={},t={};return{storeInteractionMeta:(n,r,o,i,a)=>{a=parseInt(a,10),e[a]||(e[a]={},t[a]={}),t[a][n]||(t[a][n]=new Set),t[a][n].add(r),e[a][n]={...i,scopeType:o}},getInteractionMetas:n=>Array.isArray(n)&&0!==n.length?Object.values(n.map((e=>parseInt(e,10))).reduce(((n,r)=>(Object.keys(e[r]||{}).forEach((o=>{n[o]||(n[o]={proposition:e[r][o],items:new Set}),n[o].items=new Set([...n[o].items,...t[r][o]])})),n)),{})).map((e=>{let{proposition:t,items:n}=e;return{...t,items:Array.from(n).map((e=>({id:e})))}})):[]}})(),{storeClickMeta:y,getClickSelectors:v,getClickMetas:b}=ka(),E=(e=>{let{window:t}=e;return()=>t.location})({window:window}),C={[$i]:Qi(Mi),[Zi]:Qi(xi),[ea]:Qi(Bi),[ta]:Qi(zi),[na]:Qi(Ji),[ra]:Qi(Hi),[oa]:Qi(Wi),[ia]:Qi(Ki),[aa]:Qi(Gi),[sa]:Qi(A),[ca]:Qi(Vi),[da]:Qi(Fi),[la]:Qi(_i),[ua]:Qi(xi),[pa]:Qi(Ai),[ma]:Qi(Yi)},I=(k=[Ra,Ta],e=>e?k.reduce(((e,t)=>({...e,...t(e)})),e):e);var k;const S=Oa({preprocess:I,isPageWideSurface:Mo}),D=(e=>{let{createProposition:t}=e,n=!1,r=Promise.resolve({});const o=(e,n)=>{const r=e[n.toLowerCase()];return r&&r.length>0?r:[t({scope:n,scopeDetails:{characteristics:{scopeType:ya}},items:[{schema:xo}]},!1)]};return{createCacheUpdate:e=>{const t=l();return n=!0,r=r.then((e=>t.promise.then((t=>({...e,...t}))).catch((()=>e)))),{update(n){const r=n.filter((e=>e.getScope())),i=H(r,(e=>e.getScope().toLowerCase()));return t.resolve(i),e?o(i,e):[]},cancel(){t.reject()}}},getView:e=>r.then((t=>o(t,e))),isInitialized:()=>n}})({createProposition:S}),P=$a(window),T={[xo]:Na,[qo]:Fa({modules:C,logger:n,storeInteractionMeta:m,storeClickMeta:y,autoCollectPropositionInteractions:s}),[Lo]:_a({modules:C,logger:n,storeInteractionMeta:m,autoCollectPropositionInteractions:s}),[Bo]:Ha({logger:n,executeRedirect:P,collect:c}),[Fo]:Ya({modules:cs(c),logger:n})},R=za({schemaProcessors:T,logger:n}),O=(()=>{let e=Promise.resolve([]);return{concat(t){e=e.then((e=>t.then((t=>e.concat(t))).catch((()=>e))))},clear(){const t=e;return e=Promise.resolve([]),t}}})(),N=((e,t)=>(n,r,o)=>{if(!n)return()=>{};if(!r){const e=l();return t.concat(e.promise),e.resolve}return function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];w(t)&&e({decisionsMeta:t,viewName:o}),w(n)&&e({decisionsMeta:n,eventType:Qo,propositionAction:{reason:"Conflict"},viewName:o})}})(c,O),M=(e=>{let{logger:t,prehidingStyle:n,showContainers:r,hideContainers:o,mergeQuery:i,processPropositions:a,createProposition:s,notificationHandler:c,consent:d}=e;return e=>{let{cacheUpdate:l,personalizationDetails:u,event:p,onResponse:g}=e;const{state:m,wasSet:f}=d.current();"out"===m&&f||(u.isRenderDecisions()?o(n):r()),i(p,u.createQueryDetails());const h=c(u.isRenderDecisions(),u.isSendDisplayEvent(),u.getViewName());g((e=>{let{response:n}=e;const o=n.getPayloadsByType("personalization:decisions");w(o)||t.logOnContentRendering({status:"no-offers",message:"No offers were returned.",logLevel:"info",detail:{query:u.createQueryDetails()}});const i=o.map((e=>s(e))),{page:c=[],view:d=[],proposition:p=[]}=H(i,(e=>e.getScopeType())),g=l.update(d);let m,f,y;return u.isRenderDecisions()?(({render:m,returnedPropositions:f,returnedDecisions:y}=a([...c,...g],p)),w(c)&&t.logOnContentRendering({status:"rendering-started",message:"Started rendering propositions for page-wide scope.",logLevel:"info",detail:{scope:Wt,propositions:c.map((e=>e.toJSON()))}}),w(g)&&t.logOnContentRendering({status:"rendering-started",message:"Rendering propositions started for view scope - "+u.getViewName()+".",logLevel:"info",detail:{scope:u.getViewName(),propositions:g.map((e=>e.toJSON()))}}),m().then(h),r()):({returnedPropositions:f,returnedDecisions:y}=a([],[...c,...g,...p])),{propositions:f,decisions:y}}))}})({prehidingStyle:a,showContainers:d,hideContainers:u,mergeQuery:Ia,processPropositions:R,createProposition:S,notificationHandler:N,consent:o,logger:n}),x=(e=>{let{mergeDecisionsMeta:t,collectInteractions:n,collectClicks:r,getInteractionMetas:o,getClickMetas:i,getClickSelectors:a,autoCollectPropositionInteractions:s}=e;return e=>{let{event:c,clickedElement:d}=e;const l=[];let u,p,g;if([n(d,o,s),r(d,a(),i)].forEach((e=>{let{decisionsMeta:t,propositionActionLabel:n,propositionActionToken:r,viewName:o}=e;Array.prototype.push.apply(l,t),!u&&n&&(u=n),!p&&r&&(p=r),!g&&o&&(g=o)})),w(l)){const e={eventType:zo};g&&(e.web={webPageDetails:{viewName:g}}),c.mergeXdm(e),t(c,l,[Xo.INTERACT],((e,t)=>{if(!t&&!e)return;const n={};return e&&(n.label=e),t&&(n.tokens=[t]),n})(u,p))}}})({mergeDecisionsMeta:Ca,collectInteractions:ls,collectClicks:ba,getInteractionMetas:h,getClickMetas:b,getClickSelectors:v,autoCollectPropositionInteractions:s}),q=(e=>{let{processPropositions:t,viewCache:n,logger:r}=e;return e=>{let o,i,{personalizationDetails:a,onResponse:s}=e;const c=a.getViewName();return s((()=>({propositions:o,decisions:i}))),n.getView(c).then((e=>{let n;return a.isRenderDecisions()?(({render:n,returnedPropositions:o,returnedDecisions:i}=t(e)),r.logOnContentRendering({status:"rendering-started",message:"Started rendering propositions for view scope - "+c+".",logLevel:"info",detail:{scope:c,propositions:e.map((e=>e.toJSON()))}}),n()):(({returnedPropositions:o,returnedDecisions:i}=t([],e)),[])}))}})({processPropositions:R,viewCache:D,logger:n}),L=Pa({processPropositions:R,createProposition:S,renderedPropositions:O,viewCache:D}),U=(e=>{let{targetMigrationEnabled:t}=e;return t?e=>{e.getPayload().mergeMeta({target:{migration:!0}})}:se})({targetMigrationEnabled:i}),j=Ja({processPropositions:R,createProposition:S,notificationHandler:N}),B=(e=>{let{showContainers:t,consent:n}=e;return()=>{const{state:e,wasSet:r}=n.current();e===Rt&&r?t():n.awaitConsent().catch(t)}})({showContainers:d,consent:o});return ei({getPageLocation:E,logger:n,fetchDataHandler:M,viewChangeHandler:q,onClickHandler:x,isAuthoringModeEnabled:Ea,mergeQuery:Ia,viewCache:D,showContainers:d,applyPropositions:L,setTargetMigration:U,mergeDecisionsMeta:Ca,renderedPropositions:O,onDecisionHandler:j,handleConsentFlicker:B})};gs.namespace="Personalization";const ms=qa.map((e=>mt(e)));gs.configValidators=yt({prehidingStyle:vt().nonEmpty(),targetMigrationEnabled:pt().default(!1),autoCollectPropositionInteractions:yt({[us]:dt(ms).default(Aa),[ps]:dt(ms).default(Ma)}).default({[us]:Aa,[ps]:Ma}).noUnknownFields()});const fs=e=>null!==e&&"object"==typeof e&&Object.getPrototypeOf(e)===Object.prototype,hs=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return Object.keys(e).forEach((r=>{fs(e[r])||Array.isArray(e[r])?hs(e[r],t,[...n,r]):t[[...n,r].join(".")]=e[r]})),t};var ys=e=>fs(e)?hs(e):e;const vs="matcher",ws="group",bs="historical",Es="eq",Cs="ne",Is="ex",ks="nx",Ss="gt",Ds="ge",Ps="lt",Ts="le",Rs="co",Os="nc",Ns="sw",As="ew",Ms="and",xs="or",qs="ordered";function Ls(e){return"object"==typeof e||void 0===e}function Us(e){return"number"==typeof e}const js={[Es]:{matches:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(Ls(e[t]))return!1;const r=String(e[t]).toLowerCase();for(let e=0;e<n.length;e+=1)if(!Ls(n[e])&&r===String(n[e]).toLowerCase())return!0;return!1}},[Cs]:{matches:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(Ls(e[t]))return!1;const r=String(e[t]).toLowerCase();for(let e=0;e<n.length;e+=1)if(!Ls(n[e])&&r===String(n[e]).toLowerCase())return!1;return!0}},[Is]:{matches:(e,t)=>void 0!==e[t]&&null!==e[t]},[ks]:{matches:(e,t)=>void 0===e[t]||null===e[t]},[Ss]:{matches:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];const r=e[t];if(!Us(r))return!1;for(let e=0;e<n.length;e+=1)if(Us(n[e])&&r>n[e])return!0;return!1}},[Ds]:{matches:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];const r=e[t];if(!Us(r))return!1;for(let e=0;e<n.length;e+=1)if(Us(n[e])&&r>=n[e])return!0;return!1}},[Ps]:{matches:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];const r=e[t];if(!Us(r))return!1;for(let e=0;e<n.length;e+=1)if(Us(n[e])&&r<n[e])return!0;return!1}},[Ts]:{matches:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];const r=e[t];if(!Us(r))return!1;for(let e=0;e<n.length;e+=1)if(Us(n[e])&&r<=n[e])return!0;return!1}},[Rs]:{matches:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(Ls(e[t]))return!1;const r=String(e[t]).toLowerCase();for(let e=0;e<n.length;e+=1)if(!Ls(n[e])&&-1!==r.indexOf(String(n[e]).toLowerCase()))return!0;return!1}},[Os]:{matches:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(Ls(e[t]))return!1;const r=String(e[t]).toLowerCase();for(let e=0;e<n.length;e+=1)if(!Ls(n[e])&&-1!==r.indexOf(String(n[e]).toLowerCase()))return!1;return!0}},[Ns]:{matches:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(Ls(e[t]))return!1;const r=String(e[t]).toLowerCase();for(let e=0;e<n.length;e+=1)if(!Ls(n[e])&&r.startsWith(String(n[e]).toLowerCase()))return!0;return!1}},[As]:{matches:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(Ls(e[t]))return!1;const r=String(e[t]).toLowerCase();for(let e=0;e<n.length;e+=1)if(!Ls(n[e])&&r.endsWith(n[e].toLowerCase()))return!0;return!1}}};function Bs(e){return void 0===e}const Fs="eventId",_s="eventType",Vs=["iam.eventType",_s,"type"],Hs=["iam.id","id"],zs=(e,t)=>{for(let n=0;n<t.length;n+=1)if(!Bs(e[t[n]]))return t[n];throw new Error("The event does not match the expected schema.")},Js=e=>{const t=structuredClone(e);return[[zs(t,Vs),_s],[zs(t,Hs),Fs]].forEach((e=>{let[n,r]=e;n!==r&&(t[r]=t[n],delete t[n])})),t};function Gs(e,t){return{evaluate:(e,n)=>t.evaluate(e,n),toString:()=>"Condition{type="+e+", definition="+t+"}"}}function Qs(e,t,n){return{evaluate:r=>{const o=function(e){return js[e]}(t);return!!o&&o.matches(r,e,n)}}}function Xs(e,t,n,r,o,i){return{evaluate:(a,s)=>{let c;return c=qs===i?function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1/0;try{let i=r;const a=e.every((e=>{const r=n.generateEventHash(Js(e)),a=t.events[r];if(!a)return!1;const s=a.timestamps[0],c=s>=i&&s<=o;return i=s,c}));return Number(a)}catch{return 0}}(e,a,s,r,o):function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1/0;return e.reduce(((e,i)=>{try{const a=n.generateEventHash(Js(i)),s=t.events[a];if(!s)return e;const{timestamps:c=[]}=s;return e+c.filter((e=>e>=r&&e<=o)).length}catch{return e}}),0)}(e,a,s,r,o),((e,t,n)=>{switch(t){case Ss:return e>n;case Ds:return e>=n;case Ps:return e<n;case Ts:return e<=n;case Es:return e===n;case Cs:return e!==n;default:return!1}})(c,t,n)}}}function Ws(e){const{logic:t,conditions:n}=e;return function(e,t){return{evaluate:(n,r)=>Ms===e?function(e,t,n){let r=!0;for(let o=0;o<t.length;o+=1)r=r&&t[o].evaluate(e,n);return r}(n,t,r):xs===e&&function(e,t,n){let r=!1;for(let o=0;o<t.length;o+=1)if(r=r||t[o].evaluate(e,n),r)return!0;return!1}(n,t,r)}}(t,n.map(Ys))}function Ys(e){const{type:t,definition:n}=e;if(vs===t){const e=function(e){const{key:t,matcher:n,values:r}=e;return Qs(t,n,r)}(n);return Gs(t,e)}if(ws===t){return Gs(t,Ws(n))}if(bs===t){const e=function(e){const{events:t,from:n,to:r,matcher:o,value:i,searchType:a}=e;return Xs(t,o,i,n,r,a)}(n);return Gs(t,e)}throw new Error("Can not parse condition")}function Ks(e){const{id:t,type:n,detail:r}=e;return function(e,t,n){return{id:e,type:t,detail:n}}(t,n,r)}function $s(e){const{condition:t,consequences:n,key:r}=e;return function(e,t,n){return{key:n,execute:(n,r)=>e.evaluate(n,r)?t:[],toString:()=>"Rule{condition="+e+", consequences="+t+"}"}}(Ys(t),n.map(Ks),r)}function Zs(e){const{version:t,rules:n,metadata:r}=e,o=n.map($s),i=function(e){if(!e)return;return{provider:e.provider,providerData:Object.assign({},e.providerData)}}(r);return function(e,t,n){return{version:e,rules:t,metadata:n}}(t,o,i)}function ec(e,t,n){const{providerData:r}=n,{identityTemplate:o}=r;return o.replace("<key>",t).replace("<identity>",e)}function tc(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e=>e[0];const n={};return function(){for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];const a=t(o);return Bs(n[a])&&(n[a]=e(...o)),n[a]}}function nc(e,t){const n=65535&t;return((t-n)*e|0)+(n*e|0)|0}const rc=tc((function(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const r=e.length,o=3432918353,i=461845907;let a=n;const s=-2&r;for(let n=0;n<s;n+=2)t=e.charCodeAt(n)|e.charCodeAt(n+1)<<16,t=nc(t,o),t=(131071&t)<<15|t>>>17,t=nc(t,i),a^=t,a=(524287&a)<<13|a>>>19,a=5*a+3864292196|0;return r%2==1&&(t=e.charCodeAt(s),t=nc(t,o),t=(131071&t)<<15|t>>>17,t=nc(t,i),a^=t),a^=r<<1,a^=a>>>16,a=nc(a,2246822507),a^=a>>>13,a=nc(a,3266489909),a^=a>>>16,a}),(e=>e.join("-")));const oc=tc((function(e,t){const n=rc(e),r=Math.abs(n)%t/t*100;return Math.round(100*r)/100}));function ic(e,t,n){return{allocation:oc(e,t),...n}}function ac(e,t){return t.map((t=>t.execute(e))).filter((e=>e.length>0))}function sc(e,t){!function(e){const{providerData:t}=e;if(!t)throw new Error("Provider data is missing in metadata");const{identityTemplate:n,buckets:r}=t;if(!n)throw new Error("Identity template is missing in provider data");if(!r)throw new Error("Buckets is missing in provider data")}(t);const n=e.filter((e=>!e.key)),r=function(e){const t={};for(let n=0;n<e.length;n+=1){const r=e[n];r.key&&(t[r.key]||(t[r.key]=[]),t[r.key].push(r))}return t}(e),{buckets:o}=t.providerData;return{provider:"TGT",execute:e=>{const i=function(e){const{xdm:t}=e;if(!t)throw new Error("XDM object is missing in the context");const{identityMap:n}=t;if(!n)throw new Error("Identity map is missing in the XDM object");const r=n.ECID;if(!r)throw new Error("ECID identity namespace is missing in the identity map");if(!Array.isArray(r)||0===r.length)throw new Error("ECID identities array is empty or not an array");const o=r[0].id;if(!o)throw new Error("ECID identity is missing in the identities array");return o}(e),a=ac(e,n),s=Object.keys(r),c=[];for(let n=0;n<s.length;n+=1){const a=s[n],d=r[a],l=ac(ic(ec(i,a,t),o,e),d);c.push(...l)}return[...a,...c]}}}function cc(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{generateEventHash:()=>{throw new Error("No hash function provided")}};const{rules:n,metadata:r={}}=Zs(e);return function(e,t,n){const{provider:r}=t;return"TGT"===r?sc(e,t):function(e,t){return{provider:"DEFAULT",execute:n=>e.map((e=>e.execute(n,t))).filter((e=>e.length>0))}}(e,n)}(n,r,t)}var dc=e=>{const t=structuredClone(e),n=Object.keys(t).sort().reduce(((e,n)=>{const r=t[n];return null==r||""===r?e:e+=n+":"+r}),"");return U(n)};const lc="events";var uc=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;return n=>{let r=Object.entries(n).reduce(((e,t)=>{let[n,{timestamps:r=[]}]=t;return r.forEach((t=>{e.push({key:n,timestamp:t})})),e}),[]);const o=(e=>{const t=new Date;return t.setDate(t.getDate()-e),t})(e);return r=r.filter((e=>{let{timestamp:t}=e;return t>=o})),r.sort(((e,t)=>e.timestamp-t.timestamp)),r=r.slice(-t),r.reduce(((e,t)=>{let{key:n,timestamp:r}=t;return e[n]||(e[n]={timestamps:[]}),e[n].timestamps.push(r),e}),{})}};const pc=e=>e?.scopeDetails?.activity?.id,gc=()=>{const e={};return{getItem:t=>t in e?e[t]:null,setItem:(t,n)=>{e[t]=n}}},mc=e=>{e.clear()};const fc="cjmiam",hc="schema",yc={[fc]:(e,t,n)=>{const{html:r,mobileParameters:o}=n;return{schema:Fo,data:{mobileParameters:o,webParameters:{},content:r,contentType:Ga},id:e}},[hc]:(e,t,n)=>{const{schema:r,data:o,id:i}=n;return{schema:r,data:o,id:i||e}}};const vc=e=>{const{schema:t,data:n}=e;if(t===jo)return!0;if(t!==Uo)return!1;try{const e="string"==typeof n.content?JSON.parse(n.content):n.content;return e&&Object.prototype.hasOwnProperty.call(e,"version")&&Object.prototype.hasOwnProperty.call(e,"rules")}catch{return!1}};var wc=(e,t)=>{const n=e=>{const{id:t,type:n,detail:r}=e;return"function"==typeof yc[n]?yc[n](t,n,r):r},r=pc(e),o=[],i=e=>{const{data:t={},schema:n}=e,r=n===jo?t:t.content;r&&o.push(cc("string"==typeof r?JSON.parse(r):r,{generateEventHash:dc}))};return Array.isArray(e.items)&&e.items.filter(vc).forEach(i),{rank:e?.scopeDetails?.rank||1/0,evaluate:i=>{const a=t.getEvent(Ho,r),s=a?.timestamps[0],c=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return Array.isArray(e)?e.flat(1/0):e}(o.map((e=>e.execute(i)))).map(n).map((e=>{const n=t.addEvent({eventType:Xo.TRIGGER,eventId:r}).timestamps[0];return{...e,data:{...e.data,qualifiedDate:n,displayedDate:s}}}));return{...e,items:c}},isEvaluable:o.length>0}},bc=e=>{let t,n,r,o,{storage:i,logger:a}=e,s=i;const c=e=>{if(s=e,t=((e,t)=>n=>{try{const n=e.getItem(t);return[JSON.parse(n),n.length]}catch{}return[n,0]})(s,lc),n=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e=>e;return n=>{e.setItem(t,JSON.stringify(n))}}(s,lc),[r,o]=t({}),o>2097152){const e=uc();r=e(r),n(r)}};c(i);const d=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{eventType:t,eventId:o}=e;if(!t||!o)return;const i=(new Date).getTime(),s=dc(e);return r[s]&&Array.isArray(r[s].timestamps)||(r[s]={timestamps:[]}),r[s].timestamps.push(i),r[s].timestamps.sort(),a.info("[Event History] Added event for",e,"with hash",s,"and timestamp",i),n(r),r[s]};return{addExperienceEdgeEvent:e=>{const{xdm:t}=e.getContent();if(!(e=>{const{_experience:t}=e||{};return!!t&&"object"==typeof t})(t))return;const{_experience:{decisioning:{propositionEventType:n={},propositionAction:{id:r}={},propositions:o=[]}={}}}=t;Object.keys(n).filter((e=>1===n[e])).forEach((e=>{o.forEach((t=>{(e=>e?.scopeDetails?.decisionProvider)(t)===us&&d({eventId:pc(t),eventType:e,action:r})}))}))},addEvent:d,getEvent:(e,t)=>{const n=dc({eventType:e,eventId:t});if(r[n])return r[n]},toJSON:()=>r,setStorage:c}};const Ec=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n},Cc=function(e){return!0};var Ic=e=>{let{collect:t}=e,n=()=>{};const r=new Set,o=(e,t,n)=>{const o=[e,t].join("-"),i=!n.has(o)&&((e=>[Xo.INTERACT,Xo.DISMISS].includes(e))(e)||!r.has(o));return n.add(o),r.add(o),i},i=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(!(n instanceof Array))return Promise.resolve();if(!Object.values(Xo).includes(e))return Promise.resolve();const r=[],i=new Set;return n.forEach((t=>{const n=(e=>{const{id:t,scope:n,scopeDetails:r}=e;return{id:t,scope:n,scopeDetails:r}})(t);o(e,n.id,i)&&r.push(n)})),r.length>0?t({decisionsMeta:r,eventType:$o(e),documentMayUnload:!0}):Promise.resolve()},a=(()=>{let e=Ec,t=Cc,n=0;const r={};return{add:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return"function"!=typeof e?()=>{}:(n+=1,r[n]={callback:e,params:t},{id:n,unsubscribe:(o=n,()=>{delete r[o]})});var o},emit:function(){for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];Object.values(r).forEach((n=>{let{callback:r,params:i}=n;const a=e(i,...o);t(i,...a)&&r(...a)}))},emitOne:function(n){if(!n||!r[n])return;const{callback:o,params:i}=r[n];for(var a=arguments.length,s=new Array(a>1?a-1:0),c=1;c<a;c++)s[c-1]=arguments[c];const d=e(i,...s);t(i,...d)&&o(...d)},hasSubscriptions:()=>Object.keys(r).length>0,setEmissionPreprocessor:t=>{"function"==typeof t&&(e=t)},setEmissionCondition:e=>{"function"==typeof e&&(t=e)}}})();a.setEmissionPreprocessor(((e,t)=>{const{surfacesFilter:n,schemasFilter:r}=e;return[{propositions:t.filter((e=>!n||n.includes(e.scope))).map((e=>{const{items:t=[]}=e;return{...e,items:t.filter((e=>!r||r.includes(e.schema)))}})).filter((e=>e.items.length>0))},i]}));return{refresh:e=>{n=t=>{t?a.emitOne(t,e):a.emit(e)},n()},command:{optionsValidator:e=>(e=>{let{options:t}=e;return yt({surfaces:ut(vt()).uniqueItems(),schemas:ut(vt()).uniqueItems(),callback:gt().required()}).noUnknownFields()(t)})({options:e}),run:e=>{let{surfaces:t,schemas:r,callback:o}=e;const{id:i,unsubscribe:s}=a.add(o,{surfacesFilter:t instanceof Array?t:void 0,schemasFilter:r instanceof Array?r:void 0});return n(i),Promise.resolve({unsubscribe:s})}}}};const kc="~type",Sc="~source",Dc="com.adobe.eventType.edge",Pc="com.adobe.eventType.rulesEngine",Tc="com.adobe.eventSource.requestContent";var Rc=e=>{let{contextProvider:t,decisionProvider:n}=e;return{optionsValidator:e=>(e=>{let{options:t}=e;return yt({renderDecisions:pt(),personalization:yt({decisionContext:yt({})})}).noUnknownFields()(t)})({options:e}),run:e=>{let{renderDecisions:r,decisionContext:o,applyResponse:i}=e;return i({renderDecisions:r,propositions:n.evaluate(t.getContext(o))})}}};const Oc=e=>{let{config:t,eventManager:n,createNamespacedStorage:r,consent:o,getBrowser:i,logger:a}=e;const{orgId:s,personalizationStorageEnabled:c}=t,d=fa({eventManager:n,mergeDecisionsMeta:Ca}),l=r(_(s)+".decisioning.");c||mc(l.persistent);const u=bc({storage:gc(),logger:a}),p=(e=>{let{eventRegistry:t}=e;const n={},r=e=>{const r=pc(e);if(!r)return;const o=wc(e,t);o.isEvaluable&&(n[r]=o)};return{addPayload:r,addPayloads:e=>{e.forEach(r)},evaluate:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.values(n).sort(((e,t)=>{let{rank:n}=e,{rank:r}=t;return n-r})).map((t=>t.evaluate(e))).filter((e=>e.items.length>0))}}})({eventRegistry:u}),g=(e=>{let{eventRegistry:t,window:n,getBrowser:r}=e;const o=(new Date).getTime(),i=()=>{const e=new Date,t=e.getTime();return{pageLoadTimestamp:o,currentTimestamp:t,currentDate:e.getDate(),"~state.com.adobe.module.lifecycle/lifecyclecontextdata.dayofweek":e.getDay()+1,"~state.com.adobe.module.lifecycle/lifecyclecontextdata.hourofday":e.getHours(),currentMinute:e.getMinutes(),currentMonth:e.getMonth(),currentYear:e.getFullYear(),pageVisitDuration:t-o,"~timestampu":t/1e3,"~timestampz":e.toISOString()}},a={browser:{name:r()},page:{title:n.title,url:n.url,...de(n.url)},referringPage:{url:n.referrer,...de(n.referrer)}};return{getContext:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const r={...{...a,...i(),window:{height:n.height,width:n.width,scrollY:n.scrollY,scrollX:n.scrollX},"~sdkver":hn},...e};return{...ys(r),events:t.toJSON()}}}})({eventRegistry:u,window:window,getBrowser:i}),m=Rc({contextProvider:g,decisionProvider:p}),f=Ic({collect:d});let h;return{lifecycle:{onDecision(e){let{propositions:t}=e;f.refresh(t)},onComponentsRegistered(e){var t;t=e.lifecycle,h=e=>{let{renderDecisions:n=!1,propositions:r=[],event:o,personalization:i}=e;return t&&t.onDecision({renderDecisions:n,propositions:r,event:o,personalization:i}),{propositions:r}},c&&o.awaitConsent().then((()=>{u.setStorage(l.persistent)})).catch((()=>{l&&mc(l.persistent)}))},onBeforeEvent(e){let{event:t,renderDecisions:n,personalization:r={},onResponse:o=se}=e;const{decisionContext:i={}}=r;o((e=>{let{renderDecisions:t,decisionProvider:n,applyResponse:r,event:o,personalization:i,decisionContext:a}=e;const s={...ys(o.getContent()),...a};return e=>{let{response:a}=e;if(n.addPayloads(a.getPayloadsByType("personalization:decisions")),!o.hasQuery())return{propositions:[]};const c=n.evaluate(s);return r({renderDecisions:t,propositions:c,event:o,personalization:i})}})({renderDecisions:n,decisionProvider:p,applyResponse:h,event:t,personalization:r,decisionContext:g.getContext({[kc]:Dc,[Sc]:Tc,...i})}))},onBeforeRequest(e){let{request:t}=e;const n=t.getPayload().toJSON(),{events:r=[]}=n;0!==r.length&&r.forEach((e=>u.addExperienceEdgeEvent(e)))}},commands:{evaluateRulesets:{run:e=>{let{renderDecisions:t,personalization:n={}}=e;const{decisionContext:r={}}=n;return m.run({renderDecisions:t,decisionContext:{[kc]:Pc,[Sc]:Tc,...r},applyResponse:h})},optionsValidator:m.optionsValidator},subscribeRulesetItems:f.command}}};Oc.namespace="RulesEngine",Oc.configValidators=yt({personalizationStorageEnabled:pt().default(!1)});var Nc=yt({streamingMedia:yt({channel:vt().nonEmpty().required(),playerName:vt().nonEmpty().required(),appVersion:vt(),mainPingInterval:ft().minimum(10).maximum(50).default(10),adPingInterval:ft().minimum(1).maximum(10).default(10)}).noUnknownFields()}),Ac=e=>{let{config:t,trackMediaEvent:n,trackMediaSession:r,mediaResponseHandler:o}=e;return{lifecycle:{onBeforeEvent(e){let{mediaOptions:t,onResponse:n=se}=e;if(!t)return;const{legacy:r,playerId:i,getPlayerDetails:a}=t;r||n((e=>{let{response:t}=e;return o({playerId:i,getPlayerDetails:a,response:t})}))}},commands:{createMediaSession:{optionsValidator:e=>(e=>{let{options:t}=e;return dt([yt({playerId:vt().required(),getPlayerDetails:gt().required(),xdm:yt({mediaCollection:yt({sessionDetails:yt(lt()).required()})}),edgeConfigOverrides:yt({})}).required(),yt({xdm:yt({mediaCollection:yt({playhead:ft().required(),sessionDetails:yt(lt()).required()})}),edgeConfigOverrides:yt({})}).required()],"Error validating the createMediaSession command options.")(t)})({options:e}),run:r},sendMediaEvent:{optionsValidator:e=>(e=>{let{options:t}=e;return dt([yt({playerId:vt().required(),xdm:yt({eventType:wt(...Object.values(Gr)).required(),mediaCollection:yt(lt())}).required()}).required(),yt({xdm:yt({eventType:wt(...Object.values(Gr)).required(),mediaCollection:yt({playhead:ft().integer().required(),sessionID:vt().required()}).required()}).required()}).required()],"Error validating the sendMediaEvent command options.")(t)})({options:e}),run:e=>t.streamingMedia?n(e):Promise.reject(new Error("Streaming media is not configured."))}}}};const Mc=e=>{let{config:t,logger:n,eventManager:r,sendEdgeNetworkRequest:o,consent:i}=e;const a=Yr(),s=Qr({config:t,eventManager:r,consent:i,sendEdgeNetworkRequest:o,setTimestamp:fn((()=>new Date))}),c=Kr({mediaSessionCacheManager:a,mediaEventManager:s,config:t}),d=$r({config:t,mediaEventManager:s,mediaSessionCacheManager:a}),l=eo({mediaSessionCacheManager:a,config:t,trackMediaEvent:c});return Ac({config:t,trackMediaEvent:c,mediaResponseHandler:l,trackMediaSession:d})};Mc.namespace="Streaming media",Mc.configValidators=Nc;var xc=Object.freeze({__proto__:null,activityCollector:Ar,audiences:qr,consent:Hr,eventMerge:Jr,mediaAnalyticsBridge:Eo,personalization:gs,rulesEngine:Oc,streamingMedia:Mc});(e=>{let{components:t}=e;const n=window.__alloyNS;n&&n.forEach((e=>{const n=It({console:$n,locationSearch:window.location.search,createLogger:Xt,instanceName:e,createNamespacedStorage:Kn,getMonitors:mn}),r=(e=>t=>{let[n,r,[o,i]]=t;e(o,i).then(n,r)})(sr({instanceName:e,logController:n,components:t})),o=window[e].q;o.push=r,n.logger.logOnInstanceCreated({instance:r}),o.forEach(r)}))})({components:Object.values(xc)})}();